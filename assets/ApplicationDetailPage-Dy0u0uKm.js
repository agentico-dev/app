import{p as ue,u as Z,q as E,t as z,r as p,j as e,w as me,L as Q,R as pe,m as he}from"./react-vendor-TyuC8qxg.js";import{T as xe,a as fe,b as M,c as H}from"./tabs-CrlmdC9I.js";import{B as y}from"./button-CrjcO5GY.js";import{C as L,a as k,c as q,e as O,b as J,d as ge}from"./card-DAAmTFtc.js";import{f as je,u as ye}from"./useApiForm-q2drFd0W.js";import{u as be,g as f,s as N,a as A,f as ve}from"./index-D5uhiMQB.js";import{S as v}from"./skeleton-DgsA2FIA.js";import{B as G}from"./badge-bpxx3q91.js";import{A as W,a as X,b as ee,c as se,d as re,e as te,f as ae,g as ne,h as we}from"./alert-dialog-CNFa5Ywa.js";import{I as $}from"./input-DR-AxXjG.js";import{E as Ne}from"./external-link-CnM8C7kZ.js";import{S as Ae}from"./square-pen-s_U9rDM5.js";import{T as Ce}from"./trash-2-BPjaXdHG.js";import{T as Se}from"./textarea-CzliNkd6.js";import{F as _e,a as C,b as S,c as _,d as I,f as P,e as B}from"./form-Cq2_NWTX.js";import{S as Ie,a as Pe,b as Te,c as De,d as T}from"./select-BTYSfX8Z.js";import{N as Fe}from"./ui-components-CAmpQbeX.js";import{C as Ee}from"./chevron-right-CBt-y2ls.js";import{A as Be}from"./arrow-left-B-jkszN4.js";import{C as Le}from"./code-CWvNPmcu.js";import{C as ke}from"./circle-plus-BAxS78JD.js";import"./form-components-Bc0kd4dJ.js";import"./supabase-DLYUZSEu.js";import"./utils-DVqAV-fM.js";import"./label-ppAVubx0.js";import"./chevron-down-Bdv2PV_A.js";import"./check-CG9NCPd3.js";import"./chevron-up-DyG2CS1O.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new s.Error().stack;r&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[r]="a63f9fff-c449-451a-a66d-e2cc0e2e68ac",s._sentryDebugIdIdentifier="sentry-dbid-a63f9fff-c449-451a-a66d-e2cc0e2e68ac")}catch{}async function Y(s=!1,r){let a=r.source_content||"",l=r.content_format||"json";if(s&&r.source_uri)try{const{content:u,format:h}=await je(r.source_uri);a=u,l=h,console.log("Successfully fetched content from URI:",{uri:r.source_uri,format:h,contentLength:u.length})}catch(u){throw console.error("Failed to fetch content from URI:",u),new Error(`Failed to fetch content from URI: ${u.message}`)}return{contentToSave:a,contentFormat:l}}function qe(s){const{session:r}=be(),a=ue(),l=!!(r!=null&&r.user),{data:u,isLoading:h,error:x}=Z({queryKey:["application-apis",s],queryFn:async()=>{if(!s)return[];const{data:i,error:o}=await N.from("application_apis").select("*").eq("application_id",s).order("created_at",{ascending:!1});if(o)throw o;return i},enabled:!!s}),b=E({mutationFn:async i=>{if(!(r!=null&&r.user))throw new Error("Authentication required");const{shouldFetchContent:o,...n}=i,{contentToSave:j,contentFormat:t}=await Y(o,n),{data:c,error:m}=await N.from("application_apis").insert({name:n.name,description:n.description,application_id:n.application_id,status:n.status||"active",version:n.version,source_uri:n.source_uri,source_content:n.source_content||j,content_format:t,tags:n.tags||[]}).select();if(m)throw console.error("Error creating API:",m),m;const w=Array.isArray(c)?c[0]:c;if(w.source_content)try{w.source_content=j}catch(F){console.error("Error with returned source_content:",F),w.source_content=""}return w},onSuccess:()=>{a.invalidateQueries({queryKey:["application-apis",s]}),f.success("API created successfully")},onError:i=>{f.error("Error creating API: "+i.message)}}),d=E({mutationFn:async({id:i,fetchContent:o=!1,...n})=>{if(!(r!=null&&r.user))throw new Error("Authentication required");console.log("Updating API with data:",{id:i,fetchContent:o,...n});const{contentToSave:j,contentFormat:t}=await Y(o,n),c={};n.name!==void 0&&(c.name=n.name),n.description!==void 0&&(c.description=n.description),n.status!==void 0&&(c.status=n.status),n.version!==void 0&&(c.version=n.version),n.source_uri!==void 0&&(c.source_uri=n.source_uri),n.tags!==void 0&&(c.tags=n.tags),n.protocol!==void 0&&(c.protocol=n.protocol),n.is_public!==void 0&&(c.is_public=n.is_public),j!==void 0&&(c.source_content=j,c.content_format=t),c.updated_at=new Date().toISOString(),console.log("Final update data to be sent to Supabase:",c);const{error:m}=await N.from("application_apis").update(c).eq("id",i);if(m)throw console.error("Error updating API:",m),m;return console.log("API updated successfully in Supabase"),{id:i,...n,...c}},onSuccess:i=>{console.log("Update successful, invalidating queries",i),a.invalidateQueries({queryKey:["application-apis",s]}),a.invalidateQueries({queryKey:["application-api",i.id]}),f.success("API updated successfully")},onError:i=>{console.error("Update API error:",i),f.error("Error updating API: "+i.message)}}),g=E({mutationFn:async i=>{if(!(r!=null&&r.user))throw new Error("Authentication required");const{error:o}=await N.from("application_apis").delete().eq("id",i);if(o)throw o;return i},onSuccess:()=>{a.invalidateQueries({queryKey:["application-apis",s]}),f.success("API deleted successfully")},onError:i=>{f.error("Error deleting API: "+i.message)}});return{apis:u,isLoading:h,error:x,isAuthenticated:l,createApi:b,updateApi:d,deleteApi:g}}function $e({applicationId:s}){const r=z(),{apis:a,isLoading:l,error:u,deleteApi:h}=qe(s),[x,b]=p.useState(""),[d,g]=p.useState(null),i=a==null?void 0:a.filter(t=>t.name.toLowerCase().includes(x.toLowerCase())||t.description&&t.description.toLowerCase().includes(x.toLowerCase())),o=()=>{d&&(h.mutate(d.id),g(null))},n=t=>{const c=new Date(t);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(c)},j=t=>{switch(t){case"active":return"bg-green-500";case"inactive":return"bg-gray-500";case"deprecated":return"bg-amber-500";default:return"bg-blue-500"}};return l?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((t,c)=>e.jsxs(L,{children:[e.jsx(k,{children:e.jsx(v,{className:"h-5 w-1/3"})}),e.jsxs(q,{children:[e.jsx(v,{className:"h-4 w-full"}),e.jsx(v,{className:"h-4 w-2/3 mt-2"})]}),e.jsx(O,{children:e.jsx(v,{className:"h-10 w-20"})})]},c))}):u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Error loading APIs"}),e.jsx("p",{className:"text-muted-foreground",children:"There was a problem loading the API list. Please try again."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx($,{placeholder:"Search APIs...",value:x,onChange:t=>b(t.target.value),className:"max-w-sm"})}),i&&i.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map(t=>e.jsxs(L,{className:"overflow-hidden",children:[e.jsxs(k,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(J,{className:"text-lg font-medium",children:t.name}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:`rounded-full h-2 w-2 ${j(t.status)}`}),e.jsx("span",{className:"text-xs capitalize",children:t.status})]})]}),t.version&&e.jsxs(G,{variant:"outline",className:"mt-1",children:["v",t.version]})]}),e.jsxs(q,{className:"pb-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.description||"No description provided"}),t.endpoint_url&&e.jsxs("div",{className:"mt-3 flex items-center text-sm",children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),e.jsx("a",{href:t.endpoint_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline truncate",children:t.endpoint_url})]}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-1",children:t.tags&&t.tags.map((c,m)=>e.jsx(G,{variant:"secondary",className:"text-xs",children:c},m))}),e.jsxs("p",{className:"mt-4 text-xs text-muted-foreground",children:["Created: ",n(t.created_at)]})]}),e.jsxs(O,{className:"flex justify-between pt-0",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>r(`/applications/${s}/apis/${t.id}`),children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"})," Edit"]}),e.jsxs(y,{variant:"destructive",size:"sm",onClick:()=>g(t),children:[e.jsx(Ce,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},t.id))}):e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"No APIs found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:x?"No APIs match your search criteria.":"This application doesn't have any APIs yet."}),e.jsx(y,{onClick:()=>r(`/applications/${s}/apis/new`),children:"Create your first API"})]}),e.jsx(W,{open:!!d,onOpenChange:t=>!t&&g(null),children:e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Are you sure you want to delete this API?"}),e.jsxs(re,{children:['This action cannot be undone. This will permanently delete the API "',d==null?void 0:d.name,'" and all its associated data.']})]}),e.jsxs(te,{children:[e.jsx(ae,{children:"Cancel"}),e.jsx(ne,{onClick:o,children:"Delete"})]})]})})]})}function Re(){return{mutate:async s=>Promise.resolve()}}function Ue(){return{mutate:async s=>Promise.resolve()}}function ze({application:s}){const r=z(),[a,l]=p.useState(!1),u=Re(),h=Ue(),[x,b]=p.useState({name:s.name,description:s.description||"",category:s.category||"",status:s.status}),d=me({defaultValues:x});p.useEffect(()=>{b({name:s.name,description:s.description||"",category:s.category||"",status:s.status}),d.reset({name:s.name,description:s.description||"",category:s.category||"",status:s.status})},[s,d]);const g=async o=>{l(!0);try{await u.mutate({...s,...o}),f.success("Application updated successfully")}catch(n){console.error("Error updating application:",n),f.error("Failed to update application")}finally{l(!1)}},i=async()=>{try{await h.mutate(s.id),f.success("Application deleted successfully"),r("/applications")}catch(o){console.error("Error deleting application:",o),f.error("Failed to delete application")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(_e,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(g),className:"space-y-6",children:[e.jsx(C,{control:d.control,name:"name",render:({field:o})=>e.jsxs(S,{children:[e.jsx(_,{children:"Application Name"}),e.jsx(I,{children:e.jsx($,{...o})}),e.jsx(P,{})]})}),e.jsx(C,{control:d.control,name:"description",render:({field:o})=>e.jsxs(S,{children:[e.jsx(_,{children:"Description"}),e.jsx(I,{children:e.jsx(Se,{...o})}),e.jsx(B,{children:"A brief description of what this application does."}),e.jsx(P,{})]})}),e.jsx(C,{control:d.control,name:"category",render:({field:o})=>e.jsxs(S,{children:[e.jsx(_,{children:"Category"}),e.jsx(I,{children:e.jsx($,{...o})}),e.jsx(B,{children:"The category this application belongs to."}),e.jsx(P,{})]})}),e.jsx(C,{control:d.control,name:"status",render:({field:o})=>e.jsxs(S,{children:[e.jsx(_,{children:"Status"}),e.jsxs(Ie,{onValueChange:o.onChange,defaultValue:o.value,value:o.value,children:[e.jsx(I,{children:e.jsx(Pe,{children:e.jsx(Te,{placeholder:"Select a status"})})}),e.jsxs(De,{children:[e.jsx(T,{value:"active",children:"Active"}),e.jsx(T,{value:"development",children:"Development"}),e.jsx(T,{value:"maintenance",children:"Maintenance"}),e.jsx(T,{value:"archived",children:"Archived"})]})]}),e.jsx(B,{children:"The current status of this application."}),e.jsx(P,{})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(y,{type:"submit",disabled:a,children:a?"Saving...":"Save Changes"})})]})}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-destructive",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Once you delete an application, there is no going back. Please be certain."}),e.jsxs(W,{children:[e.jsx(we,{asChild:!0,children:e.jsx(y,{variant:"destructive",children:"Delete Application"})}),e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Are you absolutely sure?"}),e.jsxs(re,{children:['This action cannot be undone. This will permanently delete the application "',s.name,'" and all of its associated data.']})]}),e.jsxs(te,{children:[e.jsx(ae,{children:"Cancel"}),e.jsx(ne,{onClick:i,children:"Yes, delete application"})]})]})]})]})]})}const ie=p.forwardRef(({...s},r)=>e.jsx("nav",{ref:r,"aria-label":"breadcrumb",...s}));ie.displayName="Breadcrumb";const oe=p.forwardRef(({className:s,...r},a)=>e.jsx("ol",{ref:a,className:A("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",s),...r}));oe.displayName="BreadcrumbList";const D=p.forwardRef(({className:s,...r},a)=>e.jsx("li",{ref:a,className:A("inline-flex items-center gap-1.5",s),...r}));D.displayName="BreadcrumbItem";const R=p.forwardRef(({asChild:s,className:r,...a},l)=>{const u=s?Fe:"a";return e.jsx(u,{ref:l,className:A("transition-colors hover:text-foreground",r),...a})});R.displayName="BreadcrumbLink";const ce=p.forwardRef(({className:s,...r},a)=>e.jsx("span",{ref:a,role:"link","aria-disabled":"true","aria-current":"page",className:A("font-normal text-foreground",s),...r}));ce.displayName="BreadcrumbPage";const U=({children:s,className:r,...a})=>e.jsx("li",{role:"presentation","aria-hidden":"true",className:A("[&>svg]:size-3.5",r),...a,children:s??e.jsx(Ee,{})});U.displayName="BreadcrumbSeparator";function Ve({items:s}){return e.jsx(ie,{className:"mb-4",children:e.jsxs(oe,{children:[e.jsx(D,{children:e.jsx(R,{asChild:!0,children:e.jsx(Q,{to:"/",children:"Home"})})}),e.jsx(U,{}),s.map((r,a)=>{const l=a===s.length-1;return e.jsx(pe.Fragment,{children:l?e.jsx(D,{children:e.jsxs(ce,{children:[r.icon&&e.jsx("span",{className:"mr-1",children:r.icon}),r.label]})}):e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsx(R,{asChild:!0,children:e.jsxs(Q,{to:r.path||"#",children:[r.icon&&e.jsx("span",{className:"mr-1",children:r.icon}),r.label]})})}),e.jsx(U,{})]})},`breadcrumb-item-${a}`)})]})})}function gs(){const{id:s,orgSlug:r,appSlug:a}=he(),l=z(),{toast:u}=ve(),[h,x]=p.useState("apis"),b=async()=>{if(console.log("Fetching application by slug:",r,a),!r||!a)return null;const{data:le,error:V}=await N.from("organizations").select("id").eq("slug",r).single();if(V)throw V;const{data:de,error:K}=await N.from("applications").select("*").eq("organization_id",le.id).eq("slug",a).single();if(K)throw K;return de},{data:d,isLoading:g,error:i}=ye(s),{data:o,isLoading:n,error:j}=Z({queryKey:["application",r,a],queryFn:b,enabled:!s&&!!r&&!!a}),t=d||o,c=g||n,m=i||j;p.useEffect(()=>{m&&(u({title:"Error loading application",description:m.message,variant:"destructive"}),l("/apps"))},[m,l,u]);const w=()=>r&&a?`/apps/${r}@${a}`:t!=null&&t.organization_slug&&(t!=null&&t.slug)?`/apps/${t.organization_slug}@${t.slug}`:"/apps",F=[{label:"Applications",path:"/applications"},{label:(t==null?void 0:t.name)||"Application Details",path:w()}];return e.jsxs("div",{className:"container py-6 space-y-6",children:[e.jsx(Ve,{items:F}),e.jsx(y,{variant:"ghost",asChild:!0,children:e.jsxs("div",{onClick:()=>l("/apps"),children:[e.jsx(Be,{className:"mr-2 h-4 w-4"})," Back to Applications"]})}),c?e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{className:"h-8 w-1/3"}),e.jsx(v,{className:"h-4 w-1/2"}),e.jsx(v,{className:"h-[400px] w-full"})]}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:t.name}),e.jsx("p",{className:"text-muted-foreground",children:t.description})]}),e.jsxs(xe,{defaultValue:h,onValueChange:x,children:[e.jsxs(fe,{className:"grid grid-cols-2 w-full max-w-md",children:[e.jsxs(M,{value:"apis",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"})," APIs"]}),e.jsx(M,{value:"settings",children:"Settings"})]}),e.jsxs(H,{value:"apis",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold tracking-tight bg-gradient-to-r from-primary to-accent-500 bg-clip-text text-transparent",children:"Application APIs"}),e.jsxs(y,{onClick:()=>{r&&a?l(`/apps/${r}@${a}/apis/new`):s&&l(`/applications/${s}/apis/new`)},children:[e.jsx(ke,{className:"h-4 w-4 mr-2"})," New API"]})]}),e.jsx($e,{applicationId:t.id})]}),e.jsx(H,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(L,{children:[e.jsxs(k,{children:[e.jsx(J,{children:"Application Settings"}),e.jsx(ge,{children:"Manage your application settings and preferences"})]}),e.jsx(q,{children:e.jsx(ze,{application:t})})]})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Application not found"}),e.jsx("p",{className:"text-muted-foreground",children:"The application you're looking for doesn't exist or you don't have access to it."}),e.jsx(y,{className:"mt-4",onClick:()=>l("/apps"),children:"Go to Applications"})]})]})}export{gs as default};
//# sourceMappingURL=ApplicationDetailPage-Dy0u0uKm.js.map

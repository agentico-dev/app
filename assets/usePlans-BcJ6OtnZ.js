import{j as r}from"./react-vendor-BIgZFnT2.js";import{R as v,a as w}from"./radio-group-CGmvQLw7.js";import{C as b,d as j}from"./card-Nfi7rt9A.js";import{C as q}from"./check-DggwCmCB.js";import{b as N,u as g,d as x}from"./data-management-CvhHSD84.js";import{u as C,b as P,s as o}from"./index-CXZKCkms.js";function K({plans:c=[],selectedPlan:s,selectedPlanId:n,onSelectPlan:d}){const p=s||n||"",f=(c.length>0?c:[{id:"free",name:"Free",description:"Get started with basic features",price:0,interval:"monthly",features:["5 projects","Basic analytics","Community support"],active:!0},{id:"pro",name:"Pro",description:"For professional developers and teams",price:0,interval:"monthly",features:["Unlimited projects","Advanced analytics","Priority support","Custom integrations"],active:!0},{id:"enterprise",name:"Enterprise",description:"For large organizations with complex needs",price:0,interval:"monthly",features:["Unlimited everything","Dedicated support","Custom development","SLA guarantees","Enterprise SSO"],active:!0}]).reduce((i,t)=>(i[t.name]||(i[t.name]=[]),i[t.name].push(t),i),{});return r.jsx(v,{value:p,onValueChange:d,className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(f).map(([i,t])=>r.jsx(b,{className:`relative cursor-pointer transition-all ${t.some(u=>u.id===p)?"border-primary ring-2 ring-primary ring-offset-2":"hover:border-primary/50"}`,children:r.jsxs(j,{className:"p-6",children:[r.jsx(w,{value:t[0].id,id:i,className:"absolute right-4 top-4"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold",children:i}),r.jsx("p",{className:"text-sm text-muted-foreground",children:t[0].description})]}),r.jsxs("div",{children:[r.jsx("div",{className:"text-3xl font-bold",children:"$0"}),r.jsx("div",{className:"text-sm text-muted-foreground",children:"During beta"})]}),r.jsx("ul",{className:"space-y-2 text-sm",children:t[0].features.map((u,m)=>r.jsxs("li",{className:"flex items-center",children:[r.jsx(q,{className:"h-4 w-4 mr-2 text-primary"}),u]},m))})]})]})},i))})}function O(){var m;const c=N(),{session:s}=C(),{toast:n}=P(),d=!!s.user,{data:p=[],isLoading:y,error:f}=g({queryKey:["plans"],queryFn:async()=>{const{data:e,error:a}=await o.from("plans").select("*").order("price");if(a)throw a;return e}}),{data:i}=g({queryKey:["currentPlan",(m=s.user)==null?void 0:m.id],queryFn:async()=>{if(!s.user)return null;const{data:e,error:a}=await o.from("profiles").select("plan_id").eq("id",s.user.id).single();if(a)throw a;if(!(e!=null&&e.plan_id))return null;const{data:h,error:l}=await o.from("plans").select("*").eq("id",e.plan_id).single();if(l)throw l;return h},enabled:d}),t=x({mutationFn:async e=>{if(!s.user)throw new Error("Authentication required");const{error:a}=await o.from("profiles").update({plan_id:e,updated_at:new Date().toISOString()}).eq("id",s.user.id);if(a)throw a;const{data:h,error:l}=await o.from("plans").select("*").eq("id",e).single();if(l)throw l;return h},onSuccess:()=>{c.invalidateQueries({queryKey:["currentPlan"]}),n({title:"Plan updated",description:"Your subscription plan has been updated successfully."})},onError:e=>{n({title:"Error updating plan",description:e.message,variant:"destructive"})}}),u=x({mutationFn:async()=>{if(!s.user)throw new Error("Authentication required");const{error:e}=await o.from("profiles").update({plan_id:null,updated_at:new Date().toISOString()}).eq("id",s.user.id);if(e)throw e;return{success:!0}},onSuccess:()=>{c.invalidateQueries({queryKey:["currentPlan"]}),n({title:"Subscription canceled",description:"Your subscription has been canceled successfully."})},onError:e=>{n({title:"Error canceling subscription",description:e.message,variant:"destructive"})}});return{plans:p,currentPlan:i,isLoading:y,error:f,isAuthenticated:d,updatePlan:t,cancelSubscription:u}}export{K as P,O as u};

import{u as l,p as v,q as c}from"./react-vendor-TyuC8qxg.js";import{u as p,f as b,s as u}from"./index-D5uhiMQB.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="8dbede1f-9042-4bca-8409-d148055a8946",s._sentryDebugIdIdentifier="sentry-dbid-8dbede1f-9042-4bca-8409-d148055a8946")}catch{}function E(s,t){const{session:o}=p(),{toast:a}=b(),r=v(),g=!!o.user,{data:y,isLoading:f,error:m}=l({queryKey:["application-messages",s,t],queryFn:async()=>{if(!o.user)return[];let e=u.from("application_messages").select("*");t?e=e.eq("api_id",t):s&&(e=e.eq("application_id",s));const{data:i,error:n}=await e.order("created_at",{ascending:!1});if(n)throw n;return i},enabled:!!o.user}),_=c({mutationFn:async e=>{if(!o.user)throw new Error("Authentication required");const{data:i,error:n}=await u.from("application_messages").insert({title:e.title,content:e.content,application_id:e.application_id,api_id:e.api_id,message_type:e.message_type||"notification",status:e.status||"unread"}).select().single();if(n)throw n;return i},onSuccess:(e,i)=>{i.application_id&&r.invalidateQueries({queryKey:["application-messages",i.application_id]}),i.api_id&&r.invalidateQueries({queryKey:["application-messages",s,i.api_id]}),r.invalidateQueries({queryKey:["application-messages"]}),a({title:"Message created",description:"The message has been created successfully."})},onError:e=>{a({title:"Error creating message",description:e.message,variant:"destructive"})}}),q=c({mutationFn:async({id:e,...i})=>{if(!o.user)throw new Error("Authentication required");const{data:n,error:d}=await u.from("application_messages").update({title:i.title,content:i.content,message_type:i.message_type,api_id:i.api_id,status:i.status,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(d)throw d;return n},onSuccess:e=>{e.application_id&&r.invalidateQueries({queryKey:["application-messages",e.application_id]}),e.api_id&&r.invalidateQueries({queryKey:["application-messages",s,e.api_id]}),r.invalidateQueries({queryKey:["application-messages"]}),a({title:"Message updated",description:"The message has been updated successfully."})},onError:e=>{a({title:"Error updating message",description:e.message,variant:"destructive"})}}),w=c({mutationFn:async e=>{if(!o.user)throw new Error("Authentication required");const{error:i}=await u.from("application_messages").delete().eq("id",e);if(i)throw i;return e},onSuccess:(e,i)=>{s&&r.invalidateQueries({queryKey:["application-messages",s]}),t&&r.invalidateQueries({queryKey:["application-messages",s,t]}),r.invalidateQueries({queryKey:["application-messages"]}),a({title:"Message deleted",description:"The message has been deleted successfully."})},onError:e=>{a({title:"Error deleting message",description:e.message,variant:"destructive"})}}),h=c({mutationFn:async e=>{if(!o.user)throw new Error("Authentication required");const{data:i,error:n}=await u.from("application_messages").update({status:"read"}).eq("id",e).select().single();if(n)throw n;return i},onSuccess:e=>{e.application_id&&r.invalidateQueries({queryKey:["application-messages",e.application_id]}),e.api_id&&r.invalidateQueries({queryKey:["application-messages",s,e.api_id]}),r.invalidateQueries({queryKey:["application-messages"]})},onError:e=>{a({title:"Error updating message status",description:e.message,variant:"destructive"})}});return{messages:y,isLoading:f,error:m,isAuthenticated:g,createMessage:_,updateMessage:q,deleteMessage:w,markAsRead:h}}function M(s){const{session:t}=p();return l({queryKey:["application-message",s],queryFn:async()=>{if(!s)return null;const{data:o,error:a}=await u.from("application_messages").select("*").eq("id",s).single();if(a)throw a;return o},enabled:!!s&&!!(t!=null&&t.user)})}export{M as a,E as u};
//# sourceMappingURL=useApplicationMessages-BuJ_9Qt2.js.map

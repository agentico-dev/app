import{p as B,u as R,q as f,t as E,j as e,r as b}from"./react-vendor-pyaEZ1K4.js";import{B as C}from"./button-DgiK2e7X.js";import{u as Y,b as z,s as x,e as M}from"./index-CcMg1OWm.js";import{F as O}from"./FilterControls-BuejqQAj.js";import{C as j,a as w,b as F,c as A,d as y,e as q}from"./card-ByfXnz1U.js";import{T as V}from"./TagBadge-Dy5_MJuX.js";import{S as L}from"./star-BAQKbNG7.js";import{S as k}from"./server-p7lls_R4.js";import{C as Q}from"./circle-plus-Bzphr7W0.js";import"./ui-components-C95S_aop.js";import"./supabase-lLY5SY09.js";import"./utils-CP2dCvBX.js";import"./input-B2NTb4C1.js";import"./select-COjrux90.js";import"./chevron-down-BW6rcwXB.js";import"./check-DLiLETgU.js";import"./popover-CSwRWDcn.js";import"./dialog-CJ93zkIF.js";import"./search-D0jHYLql.js";import"./badge-BUdM99C2.js";import"./separator-DJLzSABf.js";import"./filter-DpGBqr_M.js";import"./tag-CaTyM1z0.js";function $(){const{session:r}=Y(),{toast:t}=z(),n=B(),l=!!r.user,{data:m,isLoading:d,error:c}=R({queryKey:["servers"],queryFn:async()=>{let s=x.from("servers").select("*").order("created_at",{ascending:!1});const{data:a,error:o}=await s;if(o)throw o;return a}}),i=f({mutationFn:async s=>{if(!r.user)throw new Error("Authentication required");const{data:a,error:o}=await x.from("servers").insert({name:s.name,description:s.description,type:s.type||"Standard",status:s.status||"development",organization_id:s.organization_id,user_id:r.user.id,tags:s.tags||[]}).select().single();if(o)throw o;return a},onSuccess:()=>{n.invalidateQueries({queryKey:["servers"]}),t({title:"Server created",description:"Your new server has been created successfully."})},onError:s=>{t({title:"Error creating server",description:s.message,variant:"destructive"})}}),g=f({mutationFn:async({id:s,...a})=>{if(!r.user)throw new Error("Authentication required");const{data:o,error:h}=await x.from("servers").update({name:a.name,description:a.description,type:a.type,status:a.status,tags:a.tags,updated_at:new Date().toISOString()}).eq("id",s).select().single();if(h)throw h;return o},onSuccess:()=>{n.invalidateQueries({queryKey:["servers"]}),t({title:"Server updated",description:"The server has been updated successfully."})},onError:s=>{t({title:"Error updating server",description:s.message,variant:"destructive"})}}),u=f({mutationFn:async s=>{if(!r.user)throw new Error("Authentication required");const{error:a}=await x.from("servers").delete().eq("id",s);if(a)throw a;return s},onSuccess:s=>{n.invalidateQueries({queryKey:["servers"]}),t({title:"Server deleted",description:"The server has been deleted successfully."})},onError:s=>{t({title:"Error deleting server",description:s.message,variant:"destructive"})}}),v=f({mutationFn:async({id:s,favorite:a})=>{if(!r.user)throw new Error("Authentication required");const{data:o,error:h}=await x.from("servers").update({favorite:a}).eq("id",s).select().single();if(h)throw h;return o},onSuccess:()=>{n.invalidateQueries({queryKey:["servers"]})},onError:s=>{t({title:"Error updating favorite status",description:s.message,variant:"destructive"})}});return{servers:m,isLoading:d,error:c,isAuthenticated:l,createServer:i,updateServer:g,deleteServer:u,toggleFavorite:v}}const D={active:"bg-green-500",inactive:"bg-red-500",maintenance:"bg-yellow-500",development:"bg-blue-500",deprecated:"bg-gray-500",planning:"bg-purple-500"};function H({server:r,onToggleFavorite:t,tags:n}){const l=E(),m=()=>{l(`/servers/${r.id}`)},d=async c=>{c.stopPropagation(),await t(r.id,r.favorite)};return e.jsx(j,{className:"overflow-hidden hover:shadow-md transition-shadow cursor-pointer",onClick:m,children:e.jsxs("div",{className:"relative",children:[e.jsxs(w,{className:"pb-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${D[r.status.toLowerCase()]||"bg-gray-500"}`}),e.jsx(F,{className:"text-lg",children:r.name})]}),e.jsx("button",{onClick:d,className:"text-muted-foreground hover:text-yellow-400 transition-colors","aria-label":r.favorite?"Remove from favorites":"Add to favorites",children:r.favorite?e.jsx(L,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"}):e.jsx(L,{className:"h-5 w-5"})})]}),e.jsx(A,{className:"line-clamp-2",children:r.description||"No description available"})]}),e.jsxs(y,{className:"pt-4",children:[e.jsx("div",{className:"flex items-center text-sm text-muted-foreground mb-2",children:e.jsxs("div",{className:"flex items-center mr-4",children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:r.type})]})}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[r.tags.slice(0,3).map(c=>{var i;return e.jsx(V,{name:((i=n.find(g=>g.id===c))==null?void 0:i.name)||"Unknown"},c)}),r.tags.length>3&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",r.tags.length-3," more"]})]})]}),e.jsxs(q,{className:"pt-0 text-xs text-muted-foreground",children:["Created ",new Date(r.created_at).toLocaleDateString()]})]})},r.id)}function I({count:r=6}){return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:r}).map((t,n)=>e.jsxs(j,{className:"animate-pulse",children:[e.jsx(w,{className:"h-24 bg-muted"}),e.jsxs(y,{className:"py-4",children:[e.jsx("div",{className:"h-5 bg-muted rounded mb-2 w-3/4"}),e.jsx("div",{className:"h-4 bg-muted rounded w-1/2"})]}),e.jsx(q,{children:e.jsx("div",{className:"h-4 bg-muted rounded w-full"})})]},n))})}function U({hasServers:r,isFiltered:t,searchQuery:n}){const l=E();return e.jsxs(j,{className:"mt-8",children:[e.jsxs(w,{children:[e.jsx(F,{className:"text-xl",children:"No Servers Found"}),e.jsx(A,{children:r&&t?"No servers match your current filters. Try changing your search criteria.":"You haven't created any servers yet. Click 'New Server' to get started."})]}),e.jsxs(y,{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(k,{className:"h-16 w-16 text-muted-foreground mb-4"}),e.jsxs(C,{onClick:()=>l("/servers/new"),className:"mt-4",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Create Your First Server"]})]})]})}function G({servers:r,filteredServers:t,isLoading:n,toggleFavorite:l,tags:m,searchValue:d,selectedStatus:c,selectedTags:i}){if(n)return e.jsx(I,{});const g=d!==""||c!==null||i.length>0,u=r&&r.length>0;return t.length===0?e.jsx(U,{hasServers:u,isFiltered:g,searchQuery:d}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(v=>e.jsx(H,{server:v,onToggleFavorite:l,tags:m},v.id))})}function je(){const r=E(),{servers:t,isLoading:n,error:l,toggleFavorite:m}=$(),{tags:d,isLoading:c}=M(),[i,g]=b.useState(""),[u,v]=b.useState(null),[s,a]=b.useState([]),o=(t||[]).filter(p=>{var T;const S=i===""||p.name.toLowerCase().includes(i.toLowerCase())||((T=p.description)==null?void 0:T.toLowerCase().includes(i.toLowerCase())),N=u===null||p.status.toLowerCase()===u.toLowerCase(),K=s.length===0||s.every(P=>p.tags.includes(P));return S&&N&&K}),h=async(p,S)=>{try{await m.mutateAsync({id:p,favorite:!S})}catch(N){console.error("Error toggling favorite:",N)}},_=[{label:"All Statuses",value:null},{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Maintenance",value:"maintenance"},{label:"Development",value:"development"},{label:"Deprecated",value:"deprecated"},{label:"Planning",value:"planning"}];return l?e.jsx("div",{className:"container py-8",children:e.jsxs(j,{className:"border-destructive",children:[e.jsx(w,{children:e.jsx(F,{className:"text-destructive",children:"Error Loading Servers"})}),e.jsxs(y,{children:[e.jsx("p",{children:"There was an error loading the servers. Please try again later."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:l.message})]}),e.jsx(q,{children:e.jsx(C,{onClick:()=>window.location.reload(),children:"Retry"})})]})}):e.jsxs("div",{className:"container py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Servers"}),e.jsxs(C,{onClick:()=>r("/servers/new"),children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"New Server"]})]}),e.jsx(O,{searchValue:i,onSearchValueChange:g,statusOptions:_,selectedStatus:u,onStatusChange:v,tags:d,selectedTags:s,onTagsChange:a}),e.jsx(G,{servers:t||[],filteredServers:o,isLoading:n||c,toggleFavorite:h,tags:d,searchValue:i,selectedStatus:u,selectedTags:s})]})}export{je as default};

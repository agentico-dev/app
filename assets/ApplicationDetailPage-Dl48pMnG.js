import{l as V,r as p,j as e,o as ue,L as Q,u as me}from"./react-vendor-BIgZFnT2.js";import{T as pe,a as he,b as K,c as H}from"./tabs-BczPh-l6.js";import{B as y}from"./button-BwNwf_Dd.js";import{C as B,a as k,d as q,e as O,b as Z,c as xe}from"./card-V8-Ke11t.js";import{f as fe,S as ge,u as je}from"./useApiForm-DikBAjij.js";import{b as ye,u as J,d as E}from"./data-management-CvhHSD84.js";import{c as ve,u as be,d as f,s as N,a as w,b as Ae}from"./index-CCNkFhSt.js";import{S as b}from"./skeleton-Ds1sbJrL.js";import{B as G}from"./badge-B5M88Wjv.js";import{A as W,a as X,b as ee,c as se,d as re,e as te,f as ae,g as ne,h as Ne}from"./alert-dialog-CgUaJole.js";import{I as $}from"./input-BLgNcvcB.js";import{T as we}from"./trash-2-D2blaPzF.js";import{T as Ce}from"./textarea-Bzd9kmtz.js";import{F as Se,a as C,b as S,c as _,d as I,f as P,e as L}from"./form-CwII6-SG.js";import{S as _e,a as Ie,b as Pe,c as Te,d as T}from"./select-Fgt86WMA.js";import{Q as Fe}from"./ui-components-CeV64dF6.js";import{C as De}from"./chevron-right-oT5me_Ws.js";import{A as Ee}from"./arrow-left-DQ-A3jIw.js";import{C as Le}from"./code-w-y94Dk0.js";import{C as Be}from"./circle-plus-BPIL71yT.js";import"./form-components-KkGWRa5t.js";import"./utils-CP2dCvBX.js";import"./label-DmJGSaxI.js";import"./chevron-down-7AMG3Sqm.js";import"./check-D24AWwEj.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=ve("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);async function Y(s=!1,r){let a=r.source_content||"",l=r.content_format||"json";if(s&&r.source_uri)try{const{content:u,format:h}=await fe(r.source_uri);a=u,l=h,console.log("Successfully fetched content from URI:",{uri:r.source_uri,format:h,contentLength:u.length})}catch(u){throw console.error("Failed to fetch content from URI:",u),new Error(`Failed to fetch content from URI: ${u.message}`)}return{contentToSave:a,contentFormat:l}}function qe(s){const{session:r}=be(),a=ye(),l=!!(r!=null&&r.user),{data:u,isLoading:h,error:x}=J({queryKey:["application-apis",s],queryFn:async()=>{if(!s)return[];const{data:i,error:o}=await N.from("application_apis").select("*").eq("application_id",s).order("created_at",{ascending:!1});if(o)throw o;return i},enabled:!!s}),v=E({mutationFn:async i=>{if(!(r!=null&&r.user))throw new Error("Authentication required");const{shouldFetchContent:o,...n}=i,{contentToSave:j,contentFormat:t}=await Y(o,n),{data:c,error:m}=await N.from("application_apis").insert({name:n.name,description:n.description,application_id:n.application_id,status:n.status||"active",version:n.version,source_uri:n.source_uri,source_content:n.source_content||j,content_format:t,tags:n.tags||[]}).select();if(m)throw console.error("Error creating API:",m),m;const A=Array.isArray(c)?c[0]:c;if(A.source_content)try{A.source_content=j}catch(D){console.error("Error with returned source_content:",D),A.source_content=""}return A},onSuccess:()=>{a.invalidateQueries({queryKey:["application-apis",s]}),f.success("API created successfully")},onError:i=>{f.error("Error creating API: "+i.message)}}),d=E({mutationFn:async({id:i,fetchContent:o=!1,...n})=>{if(!(r!=null&&r.user))throw new Error("Authentication required");console.log("Updating API with data:",{id:i,fetchContent:o,...n});const{contentToSave:j,contentFormat:t}=await Y(o,n),c={};n.name!==void 0&&(c.name=n.name),n.description!==void 0&&(c.description=n.description),n.status!==void 0&&(c.status=n.status),n.version!==void 0&&(c.version=n.version),n.source_uri!==void 0&&(c.source_uri=n.source_uri),n.tags!==void 0&&(c.tags=n.tags),n.protocol!==void 0&&(c.protocol=n.protocol),n.is_public!==void 0&&(c.is_public=n.is_public),j!==void 0&&(c.source_content=j,c.content_format=t),c.updated_at=new Date().toISOString(),console.log("Final update data to be sent to Supabase:",c);const{error:m}=await N.from("application_apis").update(c).eq("id",i);if(m)throw console.error("Error updating API:",m),m;return console.log("API updated successfully in Supabase"),{id:i,...n,...c}},onSuccess:i=>{console.log("Update successful, invalidating queries",i),a.invalidateQueries({queryKey:["application-apis",s]}),a.invalidateQueries({queryKey:["application-api",i.id]}),f.success("API updated successfully")},onError:i=>{console.error("Update API error:",i),f.error("Error updating API: "+i.message)}}),g=E({mutationFn:async i=>{if(!(r!=null&&r.user))throw new Error("Authentication required");const{error:o}=await N.from("application_apis").delete().eq("id",i);if(o)throw o;return i},onSuccess:()=>{a.invalidateQueries({queryKey:["application-apis",s]}),f.success("API deleted successfully")},onError:i=>{f.error("Error deleting API: "+i.message)}});return{apis:u,isLoading:h,error:x,isAuthenticated:l,createApi:v,updateApi:d,deleteApi:g}}function $e({applicationId:s}){const r=V(),{apis:a,isLoading:l,error:u,deleteApi:h}=qe(s),[x,v]=p.useState(""),[d,g]=p.useState(null),i=a==null?void 0:a.filter(t=>t.name.toLowerCase().includes(x.toLowerCase())||t.description&&t.description.toLowerCase().includes(x.toLowerCase())),o=()=>{d&&(h.mutate(d.id),g(null))},n=t=>{const c=new Date(t);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(c)},j=t=>{switch(t){case"active":return"bg-green-500";case"inactive":return"bg-gray-500";case"deprecated":return"bg-amber-500";default:return"bg-blue-500"}};return l?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((t,c)=>e.jsxs(B,{children:[e.jsx(k,{children:e.jsx(b,{className:"h-5 w-1/3"})}),e.jsxs(q,{children:[e.jsx(b,{className:"h-4 w-full"}),e.jsx(b,{className:"h-4 w-2/3 mt-2"})]}),e.jsx(O,{children:e.jsx(b,{className:"h-10 w-20"})})]},c))}):u?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Error loading APIs"}),e.jsx("p",{className:"text-muted-foreground",children:"There was a problem loading the API list. Please try again."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx($,{placeholder:"Search APIs...",value:x,onChange:t=>v(t.target.value),className:"max-w-sm"})}),i&&i.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map(t=>e.jsxs(B,{className:"overflow-hidden",children:[e.jsxs(k,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(Z,{className:"text-lg font-medium",children:t.name}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:`rounded-full h-2 w-2 ${j(t.status)}`}),e.jsx("span",{className:"text-xs capitalize",children:t.status})]})]}),t.version&&e.jsxs(G,{variant:"outline",className:"mt-1",children:["v",t.version]})]}),e.jsxs(q,{className:"pb-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.description||"No description provided"}),t.endpoint_url&&e.jsxs("div",{className:"mt-3 flex items-center text-sm",children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),e.jsx("a",{href:t.endpoint_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline truncate",children:t.endpoint_url})]}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-1",children:t.tags&&t.tags.map((c,m)=>e.jsx(G,{variant:"secondary",className:"text-xs",children:c},m))}),e.jsxs("p",{className:"mt-4 text-xs text-muted-foreground",children:["Created: ",n(t.created_at)]})]}),e.jsxs(O,{className:"flex justify-between pt-0",children:[e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>r(`/applications/${s}/apis/${t.id}`),children:[e.jsx(ge,{className:"h-4 w-4 mr-1"})," Edit"]}),e.jsxs(y,{variant:"destructive",size:"sm",onClick:()=>g(t),children:[e.jsx(we,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},t.id))}):e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"No APIs found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:x?"No APIs match your search criteria.":"This application doesn't have any APIs yet."}),e.jsx(y,{onClick:()=>r(`/applications/${s}/apis/new`),children:"Create your first API"})]}),e.jsx(W,{open:!!d,onOpenChange:t=>!t&&g(null),children:e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Are you sure you want to delete this API?"}),e.jsxs(re,{children:['This action cannot be undone. This will permanently delete the API "',d==null?void 0:d.name,'" and all its associated data.']})]}),e.jsxs(te,{children:[e.jsx(ae,{children:"Cancel"}),e.jsx(ne,{onClick:o,children:"Delete"})]})]})})]})}function Re(){return{mutate:async s=>Promise.resolve()}}function Ue(){return{mutate:async s=>Promise.resolve()}}function Ve({application:s}){const r=V(),[a,l]=p.useState(!1),u=Re(),h=Ue(),[x,v]=p.useState({name:s.name,description:s.description||"",category:s.category||"",status:s.status}),d=ue({defaultValues:x});p.useEffect(()=>{v({name:s.name,description:s.description||"",category:s.category||"",status:s.status}),d.reset({name:s.name,description:s.description||"",category:s.category||"",status:s.status})},[s,d]);const g=async o=>{l(!0);try{await u.mutate({...s,...o}),f.success("Application updated successfully")}catch(n){console.error("Error updating application:",n),f.error("Failed to update application")}finally{l(!1)}},i=async()=>{try{await h.mutate(s.id),f.success("Application deleted successfully"),r("/applications")}catch(o){console.error("Error deleting application:",o),f.error("Failed to delete application")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Se,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(g),className:"space-y-6",children:[e.jsx(C,{control:d.control,name:"name",render:({field:o})=>e.jsxs(S,{children:[e.jsx(_,{children:"Application Name"}),e.jsx(I,{children:e.jsx($,{...o})}),e.jsx(P,{})]})}),e.jsx(C,{control:d.control,name:"description",render:({field:o})=>e.jsxs(S,{children:[e.jsx(_,{children:"Description"}),e.jsx(I,{children:e.jsx(Ce,{...o})}),e.jsx(L,{children:"A brief description of what this application does."}),e.jsx(P,{})]})}),e.jsx(C,{control:d.control,name:"category",render:({field:o})=>e.jsxs(S,{children:[e.jsx(_,{children:"Category"}),e.jsx(I,{children:e.jsx($,{...o})}),e.jsx(L,{children:"The category this application belongs to."}),e.jsx(P,{})]})}),e.jsx(C,{control:d.control,name:"status",render:({field:o})=>e.jsxs(S,{children:[e.jsx(_,{children:"Status"}),e.jsxs(_e,{onValueChange:o.onChange,defaultValue:o.value,value:o.value,children:[e.jsx(I,{children:e.jsx(Ie,{children:e.jsx(Pe,{placeholder:"Select a status"})})}),e.jsxs(Te,{children:[e.jsx(T,{value:"active",children:"Active"}),e.jsx(T,{value:"development",children:"Development"}),e.jsx(T,{value:"maintenance",children:"Maintenance"}),e.jsx(T,{value:"archived",children:"Archived"})]})]}),e.jsx(L,{children:"The current status of this application."}),e.jsx(P,{})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx(y,{type:"submit",disabled:a,children:a?"Saving...":"Save Changes"})})]})}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-destructive",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Once you delete an application, there is no going back. Please be certain."}),e.jsxs(W,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(y,{variant:"destructive",children:"Delete Application"})}),e.jsxs(X,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Are you absolutely sure?"}),e.jsxs(re,{children:['This action cannot be undone. This will permanently delete the application "',s.name,'" and all of its associated data.']})]}),e.jsxs(te,{children:[e.jsx(ae,{children:"Cancel"}),e.jsx(ne,{onClick:i,children:"Yes, delete application"})]})]})]})]})]})}const ie=p.forwardRef(({...s},r)=>e.jsx("nav",{ref:r,"aria-label":"breadcrumb",...s}));ie.displayName="Breadcrumb";const oe=p.forwardRef(({className:s,...r},a)=>e.jsx("ol",{ref:a,className:w("flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",s),...r}));oe.displayName="BreadcrumbList";const F=p.forwardRef(({className:s,...r},a)=>e.jsx("li",{ref:a,className:w("inline-flex items-center gap-1.5",s),...r}));F.displayName="BreadcrumbItem";const R=p.forwardRef(({asChild:s,className:r,...a},l)=>{const u=s?Fe:"a";return e.jsx(u,{ref:l,className:w("transition-colors hover:text-foreground",r),...a})});R.displayName="BreadcrumbLink";const ce=p.forwardRef(({className:s,...r},a)=>e.jsx("span",{ref:a,role:"link","aria-disabled":"true","aria-current":"page",className:w("font-normal text-foreground",s),...r}));ce.displayName="BreadcrumbPage";const U=({children:s,className:r,...a})=>e.jsx("li",{role:"presentation","aria-hidden":"true",className:w("[&>svg]:size-3.5",r),...a,children:s??e.jsx(De,{})});U.displayName="BreadcrumbSeparator";function ze({items:s}){return e.jsx(ie,{className:"mb-4",children:e.jsxs(oe,{children:[e.jsx(F,{children:e.jsx(R,{asChild:!0,children:e.jsx(Q,{to:"/",children:"Home"})})}),e.jsx(U,{}),s.map((r,a)=>{const l=a===s.length-1;return e.jsx(React.Fragment,{children:l?e.jsx(F,{children:e.jsxs(ce,{children:[r.icon&&e.jsx("span",{className:"mr-1",children:r.icon}),r.label]})}):e.jsxs(e.Fragment,{children:[e.jsx(F,{children:e.jsx(R,{asChild:!0,children:e.jsxs(Q,{to:r.path||"#",children:[r.icon&&e.jsx("span",{className:"mr-1",children:r.icon}),r.label]})})}),e.jsx(U,{})]})},`breadcrumb-item-${a}`)})]})})}function hs(){const{id:s,orgSlug:r,appSlug:a}=me(),l=V(),{toast:u}=Ae(),[h,x]=p.useState("apis"),v=async()=>{if(!r||!a)return null;const{data:le,error:z}=await N.from("organizations").select("id").eq("slug",r).single();if(z)throw z;const{data:de,error:M}=await N.from("applications").select("*").eq("organization_id",le.id).eq("slug",a).single();if(M)throw M;return de},{data:d,isLoading:g,error:i}=je(s),{data:o,isLoading:n,error:j}=J({queryKey:["application",r,a],queryFn:v,enabled:!s&&!!r&&!!a}),t=d||o,c=g||n,m=i||j;p.useEffect(()=>{m&&(u({title:"Error loading application",description:m.message,variant:"destructive"}),l("/apps"))},[m,l,u]);const A=()=>r&&a?`/apps/${r}@${a}`:t!=null&&t.organization_slug&&(t!=null&&t.slug)?`/apps/${t.organization_slug}@${t.slug}`:"/apps",D=[{label:"Applications",path:"/applications"},{label:(t==null?void 0:t.name)||"Application Details",path:A()}];return e.jsxs("div",{className:"container py-6 space-y-6",children:[e.jsx(ze,{items:D}),e.jsx(y,{variant:"ghost",asChild:!0,children:e.jsxs("div",{onClick:()=>l("/apps"),children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"})," Back to Applications"]})}),c?e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{className:"h-8 w-1/3"}),e.jsx(b,{className:"h-4 w-1/2"}),e.jsx(b,{className:"h-[400px] w-full"})]}):t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:t.name}),e.jsx("p",{className:"text-muted-foreground",children:t.description})]}),e.jsxs(pe,{defaultValue:h,onValueChange:x,children:[e.jsxs(he,{className:"grid grid-cols-2 w-full max-w-md",children:[e.jsxs(K,{value:"apis",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"})," APIs"]}),e.jsx(K,{value:"settings",children:"Settings"})]}),e.jsxs(H,{value:"apis",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Application APIs"}),e.jsxs(y,{onClick:()=>{r&&a?l(`/apps/${r}@${a}/apis/new`):s&&l(`/applications/${s}/apis/new`)},children:[e.jsx(Be,{className:"h-4 w-4 mr-2"})," New API"]})]}),e.jsx($e,{applicationId:t.id})]}),e.jsx(H,{value:"settings",className:"space-y-4 mt-4",children:e.jsxs(B,{children:[e.jsxs(k,{children:[e.jsx(Z,{children:"Application Settings"}),e.jsx(xe,{children:"Manage your application settings and preferences"})]}),e.jsx(q,{children:e.jsx(Ve,{application:t})})]})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Application not found"}),e.jsx("p",{className:"text-muted-foreground",children:"The application you're looking for doesn't exist or you don't have access to it."}),e.jsx(y,{className:"mt-4",onClick:()=>l("/apps"),children:"Go to Applications"})]})]})}export{hs as default};

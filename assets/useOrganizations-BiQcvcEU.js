import{k as u,l as b,u as l,f as m}from"./index-D5uhiMQB.js";import{u as g,p as _,q as f}from"./react-vendor-TyuC8qxg.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new e.Error().stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="dd0c8c36-b463-4af3-8f10-70359ebd1e0c",e._sentryDebugIdIdentifier="sentry-dbid-dd0c8c36-b463-4af3-8f10-70359ebd1e0c")}catch{}function p(){return g({queryKey:["organizations"],queryFn:async()=>{const{data:e,error:n}=await u("organizations").select("*").order("name");if(n)throw n;return e.map(r=>({id:r.id,name:r.name,slug:r.slug||"",description:r.description||"",logo_url:r.logo_url,created_at:r.created_at,updated_at:r.updated_at,is_global:!!r.is_global}))}})}function w(e){return g({queryKey:["userOrganizations",e],queryFn:async()=>{const n=await b();if(!e)return n?[{...n,role:"member"}]:[];const{data:a,error:r}=await u("organization_members").select(`
          role,
          organization_id
        `).eq("user_id",e);if(r)throw r;if(!a||a.length===0)return n?[{...n,role:"member"}]:[];const t=a.map(i=>i.organization_id),{data:s,error:o}=await u("organizations").select("*").in("id",t);if(o)throw o;let d=s.map(i=>{const c=a.find(y=>y.organization_id===i.id);return{id:i.id,name:i.name,slug:i.slug||"",description:i.description||"",logo_url:i.logo_url,created_at:i.created_at,updated_at:i.updated_at,role:(c==null?void 0:c.role)||"member",is_global:!!i.is_global}});return n&&!d.some(i=>i.id===n.id)&&d.push({...n,role:"member"}),d},enabled:!0})}function z(e){return g({queryKey:["organization-members",e],queryFn:async()=>{if(!e)return[];const{data:n,error:a}=await u("organization_members").select("*").eq("organization_id",e);if(a)throw a;return n.map(t=>({id:t.id,organization_id:t.organization_id,user_id:t.user_id,role:t.role,created_at:t.created_at}))},enabled:!!e})}function h(){const e=_(),{session:n}=l(),{toast:a}=m();return f({mutationFn:async r=>{var i;if(console.log("Starting organization creation in mutation...",r),!n.user)throw new Error("Authentication required");const{data:t,error:s}=await u("organizations").insert({name:r.name||"",slug:r.slug||((i=r.name)==null?void 0:i.toLowerCase().replace(/\s+/g,"-"))||"",description:r.description||null,logo_url:r.logo_url||null}).select().single();if(console.log("Organization creation completed:",t),s)throw s;if(!t)throw new Error("Failed to create organization");console.log("Adding current user as owner...");const{error:o}=await u("organization_members").insert({organization_id:t.id,user_id:n.user.id,role:"owner"});if(console.log("Member added:",o),o)throw o;return{id:t.id,name:t.name,slug:t.slug||"",description:t.description||"",logo_url:t.logo_url,created_at:t.created_at,updated_at:t.updated_at}},onSuccess:()=>{e.invalidateQueries({queryKey:["organizations"]}),e.invalidateQueries({queryKey:["userOrganizations"]}),a({title:"Organization created",description:"Your new organization has been created successfully."})},onError:r=>{console.error("Error in createOrganization mutation:",r),a({title:"Error creating organization",description:r.message,variant:"destructive"})}})}function O(e){const n=_(),{session:a}=l(),{toast:r}=m();return f({mutationFn:async({email:t,role:s})=>{if(!a.user)throw new Error("Authentication required");if(!e)throw new Error("Organization ID is required");const{data:o,error:d}=await u("users").select("id").eq("email",t).single();if(d)throw new Error("User not found");if(!o)throw new Error("User not found");const{data:i,error:c}=await u("organization_members").insert({organization_id:e,user_id:o.id,role:s}).select();if(c)throw c;return i},onSuccess:()=>{n.invalidateQueries({queryKey:["organization-members"]}),r({title:"Member added",description:"The member has been added to the organization."})},onError:t=>{r({title:"Error adding member",description:t.message,variant:"destructive"})}})}function Q(){var d;const{session:e}=l(),n=!!e.user,{data:a,isLoading:r,error:t}=p(),{data:s}=w((d=e.user)==null?void 0:d.id),o=h();return{organizations:a,userOrganizations:s,isLoading:r,error:t,isAuthenticated:n,createOrganization:o}}function v(e){const{session:n}=l(),a=!!n.user,{data:r,isLoading:t,error:s}=z(e),o=O(e);return{members:r,isLoading:t,error:s,isAuthenticated:a,addMember:o}}export{v as a,Q as u};
//# sourceMappingURL=useOrganizations-BiQcvcEU.js.map

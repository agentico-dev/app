import{u as D,p as M,q as R,r as p,j as s,L as V,m as U,t as Q}from"./react-vendor-TyuC8qxg.js";import{c as J,s as y,u as G,f as B,g as x,j as W}from"./index-D5uhiMQB.js";import{a as Y,b as O,c as F,A as P,f as $,e as A,S as Z,T as X,g as ee,d as se,R as te,D as re,h as ae,F as oe,i as ie}from"./index-Dj4SeaZv.js";import{I as ne}from"./input-DR-AxXjG.js";import{S as le}from"./search-BR1MFiIH.js";import{B as z}from"./badge-bpxx3q91.js";import"./supabase-DLYUZSEu.js";import"./ui-components-CAmpQbeX.js";import"./utils-DVqAV-fM.js";import"./button-CrjcO5GY.js";import"./skeleton-DgsA2FIA.js";import"./arrow-left-B-jkszN4.js";import"./alert-dialog-CNFa5Ywa.js";import"./collapsible-FhUTsrjs.js";import"./star-sfp0mj0X.js";import"./chevron-down-Bdv2PV_A.js";import"./code-CWvNPmcu.js";import"./card-DAAmTFtc.js";import"./tabs-CrlmdC9I.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new e.Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="7536e7e6-9688-444e-9855-9922e881c6bf",e._sentryDebugIdIdentifier="sentry-dbid-7536e7e6-9688-444e-9855-9922e881c6bf")}catch{}/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=J("FolderInput",[["path",{d:"M2 9V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-1",key:"fm4g5t"}],["path",{d:"M2 13h10",key:"pgb2dq"}],["path",{d:"m9 16 3-3-3-3",key:"6m91ic"}]]);function de(e){return D({queryKey:["server-detail",e],queryFn:async()=>{if(!e)return null;const{data:r,error:t}=await y.from("servers").select("organization_id").eq("id",e).single();if(t)throw t;return r},enabled:!!e})}function ue(e){return D({queryKey:["server-ai-tools",e],queryFn:async()=>{if(!e)return[];const{data:r,error:t}=await y.from("server_tools").select("*, ai_tool:ai_tool_id(*)").eq("server_id",e);if(t)throw t;return r.map(i=>({...i.ai_tool,associated:!0}))},enabled:!!e})}function me(e){return D({queryKey:["project-tools",e],queryFn:async()=>{if(!e)return[];const{data:r,error:t}=await y.from("project_tools").select("*, ai_tool:ai_tool_id(*)").eq("project_id",e);if(t)throw t;return r.map(i=>({...i.ai_tool,associated:!1}))},enabled:!!e})}function pe(e){return D({queryKey:["organization-tools",e],queryFn:async()=>{if(!e)return[];const{data:r,error:t}=await y.from("ai_tools").select("*").eq("organization_id",e);if(t)throw t;return r.map(i=>({...i,associated:!1}))},enabled:!!e})}function fe(e){const{session:r}=G(),{toast:t}=B(),i=M(),c=R({mutationFn:async({serverId:l,aiToolId:u})=>{if(!(r!=null&&r.user))throw new Error("Authentication required");const{data:a,error:m}=await y.from("server_tools").insert({server_id:l,ai_tool_id:u}).select().single();if(m)throw m;return a},onSuccess:()=>{i.invalidateQueries({queryKey:["server-ai-tools",e]}),t({title:"AI Tool linked",description:"The AI tool has been linked to the server successfully."})},onError:l=>{t({title:"Error linking AI tool",description:l.message,variant:"destructive"})}}),f=R({mutationFn:async({serverId:l,aiToolId:u})=>{if(!(r!=null&&r.user))throw new Error("Authentication required");const{error:a}=await y.from("server_tools").delete().eq("server_id",l).eq("ai_tool_id",u);if(a)throw a;return{serverId:l,aiToolId:u}},onSuccess:()=>{i.invalidateQueries({queryKey:["server-ai-tools",e]}),t({title:"AI Tool unlinked",description:"The AI tool has been unlinked from the server successfully."})},onError:l=>{t({title:"Error unlinking AI tool",description:l.message,variant:"destructive"})}});return{linkAITool:c,unlinkAITool:f}}function he(e,r){const[t,i]=p.useState([]),[c,f]=p.useState([]),[l,u]=p.useState(!1),{data:a}=de(e),{data:m,isLoading:h}=ue(e),{data:j,isLoading:k}=me(r),{data:g,isLoading:C}=pe(a==null?void 0:a.organization_id),{linkAITool:n,unlinkAITool:w}=fe(e);return p.useEffect(()=>{if(m){const v=m||[],b=v.map(T=>T.id);if(r&&j){u(!1);const T=j.filter(L=>!b.includes(L.id));i(T),f(v)}else if(a!=null&&a.organization_id&&g){u(!0),x.warning("Displaying organization-level AI tools. Connect this server to a project for project-specific tools.");const T=g.filter(L=>!b.includes(L.id));i(T),f(v)}else i([]),f(v)}},[m,j,g,r,a]),{aiTools:[...t,...c],availableTools:t,associatedTools:c,isLoading:h||k||C,isOrganizationLevel:l,linkAITool:n,unlinkAITool:w}}function ge({searchTerm:e,setSearchTerm:r}){return s.jsxs("div",{className:"relative flex-1",children:[s.jsx(le,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),s.jsx(ne,{type:"search",placeholder:"Search tools by name or description...",className:"pl-8",value:e,onChange:t=>r(t.target.value)})]})}function ve({sortField:e,sortDirection:r,onSort:t}){return s.jsx(Y,{children:s.jsxs(O,{children:[s.jsx(F,{className:"w-[80px]",children:s.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>t("associated"),children:["Associated",e==="associated"&&(r==="asc"?s.jsx(P,{className:"ml-1 h-4 w-4"}):s.jsx($,{className:"ml-1 h-4 w-4"}))]})}),s.jsx(F,{children:s.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>t("name"),children:["Name",e==="name"&&(r==="asc"?s.jsx(P,{className:"ml-1 h-4 w-4"}):s.jsx($,{className:"ml-1 h-4 w-4"}))]})}),s.jsx(F,{children:"Description"}),s.jsx(F,{children:s.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>t("status"),children:["Status",e==="status"&&(r==="asc"?s.jsx(P,{className:"ml-1 h-4 w-4"}):s.jsx($,{className:"ml-1 h-4 w-4"}))]})}),s.jsx(F,{children:"Related Services"})]})})}function xe({tool:e,onAssociateChange:r}){var i;const t=c=>{switch(c.toLowerCase()){case"active":return"bg-green-100 text-green-800";case"development":return"bg-blue-100 text-blue-800";case"maintenance":return"bg-yellow-100 text-yellow-800";case"archived":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return s.jsxs(O,{children:[s.jsx(A,{children:s.jsx(Z,{checked:e.associated,onCheckedChange:c=>r(e.id,c)})}),s.jsx(A,{className:"font-medium",children:e.name}),s.jsx(A,{children:e.description||"No description"}),s.jsx(A,{children:s.jsx(z,{variant:"outline",className:`${t(e.status)}`,children:e.status})}),s.jsx(A,{children:s.jsxs("div",{className:"space-y-1",children:[e.application_service&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",children:"Service:"})," ",e.application_service.name]}),e.application_api&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",children:"API:"})," ",s.jsxs(V,{to:`/applications/${(i=e.application)==null?void 0:i.id}/apis/${e.application_api.id}`,className:"text-primary hover:underline",children:[e.application_api.name," ",e.application_api.version]})]}),e.application&&s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",children:"Application:"})," ",s.jsx(V,{to:`/applications/${e.application.slug}`,className:"text-primary hover:underline",children:e.application.name})]})]})})]},e.id)}function ye({isOrganizationLevel:e}){return e?s.jsxs("div",{className:"bg-amber-100 border-l-4 border-amber-500 text-amber-700 p-4 mb-4 rounded",children:[s.jsx("p",{className:"font-medium",children:"Tools listed are at organization level."}),s.jsx("p",{className:"text-sm",children:"Associate this server with a project to see project-specific tools."})]}):null}function je(){return s.jsx(O,{children:s.jsx(A,{colSpan:5,className:"h-24 text-center",children:"No tools found."})})}function be(){return s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"})})}function we({availableTools:e,associatedTools:r,isLoading:t,onAssociateChange:i,isOrganizationLevel:c=!1}){B();const f=[...e.map(n=>({...n,associated:!1})),...r.map(n=>({...n,associated:!0}))],[l,u]=p.useState(""),[a,m]=p.useState("name"),[h,j]=p.useState("asc"),g=[...f.filter(n=>n.name.toLowerCase().includes(l.toLowerCase())||n.description&&n.description.toLowerCase().includes(l.toLowerCase()))].sort((n,w)=>{if(a==="associated")return h==="asc"?Number(n.associated)-Number(w.associated):Number(w.associated)-Number(n.associated);const v=n[a],b=w[a];return typeof v=="string"&&typeof b=="string"?h==="asc"?v.localeCompare(b):b.localeCompare(v):0}),C=n=>{a===n?j(h==="asc"?"desc":"asc"):(m(n),j("asc"))};return t?s.jsx(be,{}):s.jsxs("div",{className:"space-y-4",children:[s.jsx(ye,{isOrganizationLevel:c}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(ge,{searchTerm:l,setSearchTerm:u})}),s.jsx("div",{className:"rounded-md border",children:s.jsxs(X,{children:[s.jsx(ee,{children:g.length===0?"No AI tools available.":`Showing ${g.length} AI tools`}),s.jsx(ve,{sortField:a,sortDirection:h,onSort:C}),s.jsx(se,{children:g.length===0?s.jsx(je,{}):g.map(n=>s.jsx(xe,{tool:n,onAssociateChange:i},n.id))})]})})]})}function Te({server:e}){const{availableTools:r,associatedTools:t,isLoading:i,isOrganizationLevel:c,linkAITool:f,unlinkAITool:l}=he(e.id,e.project_id),u=async(a,m)=>{try{m?await f.mutateAsync({serverId:e.id,aiToolId:a}):await l.mutateAsync({serverId:e.id,aiToolId:a})}catch(h){console.error("Error toggling tool association:",h),x.error("Failed to update tool association")}};return s.jsx(te,{defaultTab:"ai-tools",tabs:[{value:"overview",label:"Overview",description:"Detailed information about this server",content:s.jsx("p",{className:"text-muted-foreground",children:e.description||"No detailed description available for this server."})},{value:"ai-tools",label:`AI Tools (${(t==null?void 0:t.length)||0})`,description:`AI tools associated to this server ${c?"at organization level":"at project level"}`,reference:c?null:`/projects/${e.project_id}`,icon:s.jsx(ce,{className:"h-4 w-4"}),content:s.jsx(we,{availableTools:r||[],associatedTools:t||[],isLoading:i,onAssociateChange:u,isOrganizationLevel:c})},{value:"logs",label:"Logs",description:"System logs and monitoring",content:s.jsx("div",{className:"text-center p-6",children:s.jsx("p",{className:"text-muted-foreground",children:"Log monitoring is not available for this server."})})}]})}function He(){const{id:e}=U(),r=Q(),[t,i]=p.useState(null),[c,f]=p.useState(!0),{tags:l}=W(),[u,a]=p.useState(!1),[m,h]=p.useState(!1),[j,k]=p.useState("");p.useEffect(()=>{(async()=>{var I;if(e){f(!0);try{console.log("Fetching server details for ID/slug:",e);let d=y.from("servers").select(`
            *,
            project_servers!inner (
              project_id
            )
          `);const q=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e);q?d=d.eq("id",e):d=d.eq("slug",e);let{data:S,error:N}=await d;if(N){d=y.from("servers").select("*"),q?d=d.eq("id",e):d=d.eq("slug",e);const _=await d.single();S=_.data,N=_.error}if(N)throw console.error("Error fetching server details:",N),x.error(`Failed to load server: ${N.message}`),N;let E;if(Array.isArray(S)&&S.length>0){const _=S[0],H=((I=_.project_servers)==null?void 0:I.length)>0?_.project_servers[0].project_id:null;E={..._,project_id:H},delete E.project_servers}else E=S;console.log("Fetched server details:",E),i(E),k(JSON.stringify({"comming soon":"project details",see_project_management_demo:"https://youtu.be/4JJ30ytn-yY",see_oas_to_mcp_demo:"https://youtu.be/kR4pP5VZgKw"},null,2))}catch(d){console.error("Error in server fetch:",d),x.error("Failed to load server details")}finally{f(!1)}}})()},[e]);const g=()=>{r(-1)},C=()=>{t&&r(`/servers/${t.slug}/edit`)},n=async()=>{if(t)try{const{error:o}=await y.from("servers").delete().eq("id",t.id);if(o)throw o;x.success("Server deleted successfully"),r("/servers")}catch(o){console.error("Error deleting server:",o),x.error(`Failed to delete server: ${o.message}`)}},w=async()=>{t&&(await new Promise(o=>setTimeout(o,2e3)),x.success("Server imported successfully"))},v=async()=>{t&&(await new Promise(o=>setTimeout(o,2e3)),x.success("Server exported successfully"))},b=async()=>{t&&(await new Promise(o=>setTimeout(o,2e3)),x.success("Server deployed successfully"))},T=async()=>{t&&(await new Promise(o=>setTimeout(o,2e3)),x.success("Server undeployed successfully"))},L=o=>{switch(o==null?void 0:o.toLowerCase()){case"active":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"development":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"maintenance":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300";case"deprecated":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300";case"planning":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";case"inactive":return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"}},K=()=>{var o;return(o=t.tags)==null?void 0:o.map(I=>{var q;const d=((q=l.find(S=>S.id===I))==null?void 0:q.name)||"Unknown";return s.jsx(z,{variant:"secondary",children:d},I)})};return s.jsx(re,{isLoading:c,resource:t,resourceType:"Server",onGoBack:g,renderResource:()=>s.jsxs(s.Fragment,{children:[s.jsx(ae,{title:t.name,description:t.description,isFavorite:t.favorite,status:t.status,tags:[s.jsx(z,{variant:"outline",children:t.type},"type"),...K()],statusColorClass:L(t.status),onEdit:C,onDelete:n,resourceId:t.id,resourceType:"Server",isActionsOpen:u,setIsActionsOpen:a,showCodeView:m,setShowCodeView:h,handleImport:w,handleExport:v,handleDeploy:b,handleUndeploy:T}),m?s.jsxs("div",{className:"mt-6 border rounded-md overflow-hidden",children:[s.jsxs("div",{className:"p-2 bg-muted border-b flex items-center",children:[s.jsx(oe,{className:"h-4 w-4 mr-2"}),s.jsx("span",{className:"text-sm font-medium",children:"Server Code View"})]}),s.jsx("div",{className:"h-[500px]",children:s.jsx(ie,{height:"100%",defaultLanguage:"json",defaultValue:j,options:{readOnly:!1,minimap:{enabled:!1},scrollBeyondLastLine:!1,automaticLayout:!0},onChange:o=>k(o||"")})})]}):s.jsx(Te,{server:t})]})})}export{He as default};
//# sourceMappingURL=ServerDetailPage-meZAmhN_.js.map

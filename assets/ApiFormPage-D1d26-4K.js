var fe=Object.defineProperty;var ge=(s,n,r)=>n in s?fe(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r;var U=(s,n,r)=>ge(s,typeof n!="symbol"?n+"":n,r);import{R as Ne,j as e,r as g,t as W,m as ve,y as we}from"./react-vendor-TyuC8qxg.js";import{C as R,a as E,c as _,e as O,b as K,d as be}from"./card-DAAmTFtc.js";import{a as A,b as S,c as T,d as D,e as ee,f as k,F as ye}from"./form-Cq2_NWTX.js";import{c as Q,a as se,T as Ce,b as Ae,d as Se,e as Te}from"./index-D5uhiMQB.js";import{u as De}from"./useOrganizations-BiQcvcEU.js";import{a as ke,b as Fe}from"./useApiForm-q2drFd0W.js";import{I as L}from"./input-DR-AxXjG.js";import{B as w}from"./button-CrjcO5GY.js";import{R as Ie,a as $}from"./radio-group-BcLi_fAC.js";import{L as z}from"./label-ppAVubx0.js";import{T as Pe}from"./textarea-CzliNkd6.js";import{T as Le}from"./TagBadge-BJN7YXIb.js";import{C as X}from"./circle-plus-BAxS78JD.js";import{F as Re}from"./file-text-swfOyMSZ.js";import{C as Ee}from"./check-CG9NCPd3.js";import{C as _e,D as $e}from"./download-DFkLn-Kj.js";import{C as ze}from"./checkbox-Cc9WyYV7.js";import{A as V,a as B}from"./alert-CHHnXdcp.js";import{C as Me}from"./circle-alert-BjO_ybi6.js";import{A as Ve}from"./arrow-left-B-jkszN4.js";import{S as Be}from"./save-CAbDiou2.js";import{u as Ge}from"./useApplicationServices-Ydf5DmBi.js";import{S as u}from"./skeleton-DgsA2FIA.js";import{B as G}from"./badge-bpxx3q91.js";import{A as te,a as ne,b as re,c as le,d as ie,e as ce,f as oe,g as de}from"./alert-dialog-CNFa5Ywa.js";import{S as me}from"./square-pen-s_U9rDM5.js";import{T as he}from"./trash-2-BPjaXdHG.js";import{L as q}from"./loader-circle-DYphBqlP.js";import{u as Oe}from"./useApplicationMessages-BuJ_9Qt2.js";import{T as qe,a as Ze,b as H,c as J}from"./tabs-CrlmdC9I.js";import"./ui-components-CAmpQbeX.js";import"./supabase-DLYUZSEu.js";import"./utils-DVqAV-fM.js";import"./form-components-Bc0kd4dJ.js";import"./circle-C2I3inlC.js";import"./tag-y-CCJCIb.js";try{let s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new s.Error().stack;n&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[n]="a1bdec3c-7174-4e95-b950-e178f659d271",s._sentryDebugIdIdentifier="sentry-dbid-a1bdec3c-7174-4e95-b950-e178f659d271")}catch{}/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=Q("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=Q("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=Q("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);class We extends Ne.Component{constructor(){super(...arguments);U(this,"state",{hasError:!1})}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(r){console.error("ErrorBoundary caught an error:",r)}render(){return this.state.hasError?e.jsx("div",{children:"Something went wrong. Please try again later."}):this.props.children}}function Ke({selectedTags:s=[],onChange:n}){const[r,h]=g.useState(""),m=()=>{if(r.trim()&&!s.includes(r.trim())){const t=[...s,r.trim()];n(t),h("")}},o=t=>{t.key==="Enter"&&(t.preventDefault(),m())},j=t=>{n(s.filter(d=>d!==t))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{value:r,onChange:t=>h(t.target.value),onKeyDown:o,placeholder:"Add a tag",className:"flex-1"}),e.jsx(w,{type:"button",variant:"outline",size:"icon",onClick:m,disabled:!r.trim(),children:e.jsx(X,{className:"h-4 w-4"})})]}),s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.map((t,d)=>e.jsx(Le,{name:t,onRemove:()=>j(t)},d))})]})}function Qe({value:s,onChange:n,language:r="json",className:h,readOnly:m=!1}){const[o,j]=g.useState(!1),[t,d]=g.useState(s||"");g.useEffect(()=>{s!==void 0&&s!==t&&d(s)},[s]);const c=()=>{navigator.clipboard.writeText(t),j(!0),setTimeout(()=>j(!1),2e3)},i=x=>{const p=x.target.value;d(p),n(p)},N=()=>{if(!m)try{if(r==="json"){const x=JSON.stringify(JSON.parse(t||"{}"),null,2);d(x),n(x)}}catch(x){console.error("Failed to format code:",x)}};return e.jsxs("div",{className:se("relative border rounded-md",h,m?"opacity-75":""),children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[r==="json"?e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium",children:r.toUpperCase()}),m&&e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(Read Only)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!m&&e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:N,title:"Format code",type:"button",disabled:m,children:"Format"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:c,title:o?"Copied!":"Copy to clipboard",type:"button",children:o?e.jsx(Ee,{className:"h-3 w-3"}):e.jsx(_e,{className:"h-3 w-3"})})]})]}),e.jsx("textarea",{value:t,onChange:i,className:se("font-mono text-sm p-3 w-full min-h-[200px] outline-none focus:ring-0 resize-y",m&&"bg-muted cursor-not-allowed"),spellCheck:"false","data-gramm":"false",readOnly:m})]})}const Xe=({form:s,isUriValid:n,onFetchContent:r,shouldFetchContent:h,setShouldFetchContent:m,isContentMode:o,codeLanguage:j,sourceUri:t})=>{const[d,c]=g.useState(!1);return g.useEffect(()=>{(t==null?void 0:t.length)>0&&(t!=null&&t.startsWith("urn:"))?c(!0):c(!1)},[s.watch("source_uri")]),g.useEffect(()=>{t!=null&&t.startsWith("urn:")&&!o&&s.setValue("source_uri","")},[o]),e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{control:s.control,name:"source_uri",render:({field:i})=>e.jsxs(S,{children:[e.jsx(T,{children:"Source URI"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Ce,{children:e.jsxs(Ae,{open:!n,children:[e.jsx(Se,{asChild:!0,children:e.jsx(D,{children:e.jsx(L,{placeholder:"https://example.com/api-spec.json",...i,readOnly:o,className:`w-full ${d?"bg-muted":""} ${n?"":"border-red-500 focus-visible:ring-red-500"}`})})}),e.jsx(Te,{className:"bg-red-500 text-white",children:e.jsx("p",{children:"Please enter a valid URL (https://example.com/spec.json, urn:agentico:apis:[ORG]:[APP]:[SLUG]:[VERSION])"})})]})}),r&&e.jsxs(w,{type:"button",variant:"outline",onClick:r,title:"Fetch and load content from URI",disabled:o||!n,children:[e.jsx($e,{className:"h-4 w-4 mr-2"})," Fetch"]})]}),e.jsx(ee,{children:"Link to the API specification file (OpenAPI, Swagger, etc.)"}),e.jsx(k,{})]})}),m&&e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(ze,{id:"fetch-on-save",checked:h,onCheckedChange:i=>m(i),disabled:o||!n}),e.jsx("label",{htmlFor:"fetch-on-save",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:"Fetch content from URI when saving"})]}),e.jsx(A,{control:s.control,name:"source_content",render:({field:i})=>e.jsxs(S,{children:[e.jsx(T,{children:"Source Content"}),!i.value&&!o&&n&&e.jsxs(V,{className:"mb-3 bg-yellow-50 border-yellow-200",children:[e.jsx(Me,{className:"h-4 w-4 text-yellow-600"}),e.jsx(B,{className:"text-yellow-700",children:'The content is empty. Click the "Fetch" button above to load content from the URI, or check "Fetch content from URI when saving".'})]}),e.jsx(D,{children:e.jsx(Qe,{value:i.value||"",onChange:i.onChange,language:j,className:"min-h-[300px]",readOnly:!o&&(t==null?void 0:t.length)>0&&!d})}),e.jsx(ee,{children:o||!((t==null?void 0:t.length)>0)||t!=null&&t.startsWith("urn:")?"Paste or write your API specification (OpenAPI, Swagger, gRPC, etc.)":"Fetched API specification (read-only)"}),e.jsx(k,{})]})})]})};function Ye(s,n,r,h,m){const o=s.getValues("name")||"",j=n||o.toLowerCase().replace(/[^a-z0-9]/g,"-"),t=`urn:agentico:apis:${r}:${h||"app"}:${j}:${m}`;console.log("Generated URN:",t),s.setValue("source_uri",t)}const Ue=({form:s,sourceType:n,setSourceType:r,codeLanguage:h,setCodeLanguage:m,onFetchContent:o,shouldFetchContent:j,setShouldFetchContent:t,applicationSlug:d,organizationSlug:c="global",apiVersion:i="1.0.0",apiSlug:N})=>{const[x,p]=g.useState(!0),[v,y]=g.useState(!1);function b(l){try{return new URL(l),!0}catch{return/^urn:agentico:apis:[a-zA-Z0-9\-]+:[a-zA-Z0-9\-]+:[a-zA-Z0-9\-]+:[a-zA-Z0-9\-]+$/.test(l)}}const a=s.watch("source_uri"),f=s.watch("source_content"),C=s.watch("name"),F=s.watch("version");return g.useEffect(()=>{p(b(a));const l=(f==null?void 0:f.length)>0;y(l)},[a,f]),g.useEffect(()=>{console.log("Updated Source mode:",{isContentMode:v,sourceUri:a,sourceContent:f,sourceType:n})},[v,a,f,n]),g.useEffect(()=>{v&&f.length>0&&(!a||!a.startsWith("urn:"))&&(Ye(s,N,c,d,F||i),console.log("Generated URN based on content change"))},[n,f,C,F,a,N,c,d,i,s]),e.jsxs("div",{className:"space-y-4 border p-4 rounded-md",children:[e.jsx("h3",{className:"text-lg font-medium",children:"API Source"}),e.jsx(Xe,{form:s,isUriValid:x,onFetchContent:o,shouldFetchContent:j,setShouldFetchContent:t,isContentMode:v,codeLanguage:h,sourceUri:a})]})};function ae({form:s,isSubmitting:n,isNew:r,sourceType:h,setSourceType:m,codeLanguage:o,setCodeLanguage:j,onFetchContent:t,shouldFetchContent:d,setShouldFetchContent:c,applicationSlug:i,organizationSlug:N,apiVersion:x,apiSlug:p,onCancel:v}){const b=s.watch("version")||x||"1.0.0";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(A,{control:s.control,name:"name",render:({field:a})=>e.jsxs(S,{children:[e.jsx(T,{children:"API Name *"}),e.jsx(D,{children:e.jsx(L,{placeholder:"Enter API name",...a})}),e.jsx(k,{})]})}),e.jsx(A,{control:s.control,name:"version",render:({field:a})=>e.jsxs(S,{children:[e.jsx(T,{children:"API Version"}),e.jsx(D,{children:e.jsx(L,{placeholder:"e.g. 1.0, v2, etc.",...a})}),e.jsx(k,{})]})})]}),e.jsx(A,{control:s.control,name:"description",render:({field:a})=>e.jsxs(S,{children:[e.jsx(T,{children:"Description"}),e.jsx(D,{children:e.jsx(Pe,{placeholder:"Describe the purpose and functionality of this API",className:"min-h-[100px]",...a})}),e.jsx(k,{})]})}),e.jsx(A,{control:s.control,name:"status",render:({field:a})=>e.jsxs(S,{className:"space-y-3",children:[e.jsx(T,{children:"Status"}),e.jsx(D,{children:e.jsxs(Ie,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"active",id:"active"}),e.jsx(z,{htmlFor:"active",children:"Active"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"inactive",id:"inactive"}),e.jsx(z,{htmlFor:"inactive",children:"Inactive"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"deprecated",id:"deprecated"}),e.jsx(z,{htmlFor:"deprecated",children:"Deprecated"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"archived",id:"archived"}),e.jsx(z,{htmlFor:"archived",children:"Archived"})]})]})}),e.jsx(k,{})]})}),e.jsx(A,{control:s.control,name:"tags",render:({field:a})=>e.jsxs(S,{children:[e.jsx(T,{children:"Tags"}),e.jsx(D,{children:e.jsx(Ke,{selectedTags:a.value||[],onChange:a.onChange})}),e.jsx(k,{})]})}),e.jsx("div",{className:"space-y-4",children:e.jsx(Ue,{form:s,sourceType:h,setSourceType:m,codeLanguage:o,setCodeLanguage:j,onFetchContent:t,shouldFetchContent:d,setShouldFetchContent:c,applicationSlug:i,organizationSlug:N,apiVersion:b,apiSlug:p})}),e.jsxs("div",{className:"flex justify-between pt-6",children:[e.jsxs(w,{type:"button",variant:"outline",onClick:v,children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Cancel"]}),e.jsxs(w,{type:"submit",disabled:n,children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),n?"Saving...":r?"Create API":"Update API"]})]})]})}function es({apiId:s,applicationId:n}){const r=W(),{services:h,isLoading:m,error:o,deleteService:j}=Ge(n,s),[t,d]=g.useState(""),[c,i]=g.useState(null),[N,x]=g.useState(!1),p=h==null?void 0:h.filter(a=>t===""||a.name.toLowerCase().includes(t.toLowerCase())||a.description&&a.description.toLowerCase().includes(t.toLowerCase())),v=async()=>{if(c){x(!0);try{await j.mutateAsync(c.id)}finally{x(!1),i(null)}}},y=a=>{const f=new Date(a);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(f)},b=a=>{switch(a){case"active":return"bg-green-500";case"inactive":return"bg-gray-500";case"maintenance":return"bg-amber-500";default:return"bg-blue-500"}};return m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(u,{className:"h-10 w-64"}),e.jsx(u,{className:"h-10 w-40"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((a,f)=>e.jsxs(R,{children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(u,{className:"h-6 w-1/2"}),e.jsx(u,{className:"h-4 w-16 rounded-full"})]}),e.jsx(u,{className:"h-5 w-24 mt-2"})]}),e.jsxs(_,{children:[e.jsx(u,{className:"h-4 w-full mb-2"}),e.jsx(u,{className:"h-4 w-2/3 mb-4"}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-3",children:[e.jsx(u,{className:"h-5 w-16 rounded-full"}),e.jsx(u,{className:"h-5 w-20 rounded-full"})]}),e.jsx(u,{className:"h-4 w-36 mt-4"})]}),e.jsxs(O,{className:"flex justify-between",children:[e.jsx(u,{className:"h-9 w-20"}),e.jsx(u,{className:"h-9 w-20"})]})]},f))})]}):o?e.jsxs("div",{className:"text-center py-8 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Error loading services"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"There was a problem loading the service list. Please try again."}),e.jsx(w,{onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{placeholder:"Search services...",value:t,onChange:a=>d(a.target.value),className:"max-w-sm"}),e.jsxs(w,{onClick:()=>r(`/applications/${n}/services/new?api_id=${s}`),children:[e.jsx(X,{className:"h-4 w-4 mr-2"})," New Service"]})]}),p&&p.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.map(a=>e.jsxs(R,{className:"overflow-hidden",children:[e.jsxs(E,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(K,{className:"text-lg font-medium",children:a.name}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:`rounded-full h-2 w-2 ${b(a.status||"active")}`}),e.jsx("span",{className:"text-xs capitalize",children:a.status||"active"})]})]}),a.service_type&&e.jsx(G,{variant:"outline",className:"mt-1",children:a.service_type})]}),e.jsxs(_,{className:"pb-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.description||"No description provided"}),a.method&&a.path&&e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx(G,{variant:"outline",className:"uppercase font-mono",children:a.method}),e.jsx("span",{className:"text-xs font-mono truncate",children:a.path})]}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-1",children:a.tags&&a.tags.map((f,C)=>e.jsx(G,{variant:"secondary",className:"text-xs",children:f},C))}),e.jsxs("p",{className:"mt-4 text-xs text-muted-foreground",children:["Created: ",y(a.created_at)]})]}),e.jsxs(O,{className:"flex justify-between pt-0",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>r(`/applications/${n}/services/${a.id}?api_id=${s}`),children:[e.jsx(me,{className:"h-4 w-4 mr-1"})," Edit"]}),e.jsxs(w,{variant:"destructive",size:"sm",onClick:()=>i(a),children:[e.jsx(he,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},a.id))}):e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"No services found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:t?"No services match your search criteria.":"This API doesn't have any services yet."}),e.jsx(w,{onClick:()=>r(`/applications/${n}/services/new?api_id=${s}`),children:"Create your first service"})]}),e.jsx(te,{open:!!c,onOpenChange:a=>!a&&i(null),children:e.jsxs(ne,{children:[e.jsxs(re,{children:[e.jsx(le,{children:"Are you sure you want to delete this service?"}),e.jsxs(ie,{children:['This action cannot be undone. This will permanently delete the service "',c==null?void 0:c.name,'" and all its associated data.']})]}),e.jsxs(ce,{children:[e.jsx(oe,{disabled:N,children:"Cancel"}),e.jsx(de,{onClick:v,disabled:N,className:"relative",children:N?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}function ss({apiId:s,applicationId:n}){const r=W(),{messages:h,isLoading:m,error:o,deleteMessage:j,markAsRead:t}=Oe(n,s),[d,c]=g.useState(""),[i,N]=g.useState(null),[x,p]=g.useState(!1),[v,y]=g.useState(null),b=h==null?void 0:h.filter(l=>d===""||l.title.toLowerCase().includes(d.toLowerCase())||l.content.toLowerCase().includes(d.toLowerCase())),a=async()=>{if(i){p(!0);try{await j.mutateAsync(i.id)}finally{p(!1),N(null)}}},f=async l=>{y(l);try{await t.mutateAsync(l)}finally{y(null)}},C=l=>{const I=new Date(l);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(I)},F=l=>{switch(l){case"notification":return e.jsx(M,{className:"h-4 w-4 text-blue-500"});case"alert":return e.jsx(M,{className:"h-4 w-4 text-red-500"});case"info":return e.jsx(M,{className:"h-4 w-4 text-green-500"});default:return e.jsx(M,{className:"h-4 w-4"})}};return m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(u,{className:"h-10 w-64"}),e.jsx(u,{className:"h-10 w-40"})]}),e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((l,I)=>e.jsxs(R,{className:"overflow-hidden",children:[e.jsx(E,{children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx(u,{className:"h-6 w-1/3"}),e.jsx(u,{className:"h-6 w-20"})]})}),e.jsxs(_,{children:[e.jsx(u,{className:"h-4 w-full mb-2"}),e.jsx(u,{className:"h-4 w-2/3 mb-2"}),e.jsx(u,{className:"h-4 w-1/2 mb-4"}),e.jsx(u,{className:"h-4 w-32 mt-4"})]}),e.jsxs(O,{className:"flex justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{className:"h-9 w-20"}),e.jsx(u,{className:"h-9 w-28"})]}),e.jsx(u,{className:"h-9 w-20"})]})]},I))})]}):o?e.jsxs("div",{className:"text-center py-8 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Error loading messages"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"There was a problem loading the message list. Please try again."}),e.jsx(w,{onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{placeholder:"Search messages...",value:d,onChange:l=>c(l.target.value),className:"max-w-sm"}),e.jsxs(w,{onClick:()=>r(`/applications/${n}/messages/new?api_id=${s}`),children:[e.jsx(X,{className:"h-4 w-4 mr-2"})," New Message"]})]}),b&&b.length>0?e.jsx("div",{className:"space-y-4",children:b.map(l=>e.jsxs(R,{className:`overflow-hidden ${l.status==="unread"?"border-blue-300":""}`,children:[e.jsx(E,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[F(l.message_type),e.jsx(K,{className:"text-lg font-medium",children:l.title})]}),e.jsx(G,{variant:l.status==="unread"?"default":"outline",children:l.status})]})}),e.jsxs(_,{className:"pb-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:l.content}),e.jsx("p",{className:"mt-4 text-xs text-muted-foreground",children:C(l.created_at)})]}),e.jsxs(O,{className:"flex justify-between pt-0",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>r(`/applications/${n}/messages/${l.id}?api_id=${s}`),children:[e.jsx(me,{className:"h-4 w-4 mr-1"})," Edit"]}),l.status==="unread"&&e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>f(l.id),disabled:v===l.id,children:[v===l.id?e.jsx(q,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(He,{className:"h-4 w-4 mr-1"}),"Mark as Read"]})]}),e.jsxs(w,{variant:"destructive",size:"sm",onClick:()=>N(l),children:[e.jsx(he,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},l.id))}):e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"No messages found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:d?"No messages match your search criteria.":"This API doesn't have any messages yet."}),e.jsx(w,{onClick:()=>r(`/applications/${n}/messages/new?api_id=${s}`),children:"Create your first message"})]}),e.jsx(te,{open:!!i,onOpenChange:l=>!l&&N(null),children:e.jsxs(ne,{children:[e.jsxs(re,{children:[e.jsx(le,{children:"Are you sure you want to delete this message?"}),e.jsxs(ie,{children:['This action cannot be undone. This will permanently delete the message "',i==null?void 0:i.title,'".']})]}),e.jsxs(ce,{children:[e.jsx(oe,{disabled:x,children:"Cancel"}),e.jsx(de,{onClick:a,disabled:x,className:"relative",children:x?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}function as({form:s,isSubmitting:n,isNew:r,applicationId:h,sourceType:m,setSourceType:o,codeLanguage:j,setCodeLanguage:t,onFetchContent:d,shouldFetchContent:c,setShouldFetchContent:i,applicationSlug:N,organizationSlug:x,apiVersion:p,apiSlug:v,activeTab:y="details",setActiveTab:b,apiId:a}){const f=W();s.watch("source_content");const C=()=>{f(`/applications/${h}`)};return r?e.jsx("div",{children:e.jsx(ae,{form:s,isSubmitting:n,isNew:r,sourceType:m,setSourceType:o,codeLanguage:j,setCodeLanguage:t,onFetchContent:d,shouldFetchContent:c,setShouldFetchContent:i,applicationSlug:N,organizationSlug:x,apiVersion:p,apiSlug:v,onCancel:C})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(qe,{defaultValue:y,onValueChange:b||(()=>{}),className:"w-full",children:[e.jsxs(Ze,{className:"grid w-full grid-cols-3",children:[e.jsx(H,{value:"details",children:"API Details"}),e.jsx(H,{value:"services",children:"Services"}),e.jsx(H,{value:"messages",children:"Messages"})]}),e.jsx(J,{value:"details",className:"pt-4",children:e.jsx(ae,{form:s,isSubmitting:n,isNew:r,sourceType:m,setSourceType:o,codeLanguage:j,setCodeLanguage:t,onFetchContent:d,shouldFetchContent:c,setShouldFetchContent:i,applicationSlug:N,organizationSlug:x,apiVersion:p,apiSlug:v,onCancel:C})}),e.jsx(J,{value:"services",className:"pt-4",children:e.jsx(es,{apiId:a,applicationId:h})}),e.jsx(J,{value:"messages",className:"pt-4",children:e.jsx(ss,{apiId:a,applicationId:h})})]})})}const ts=({isLoading:s,error:n,applicationMissing:r})=>s?e.jsxs(V,{children:[e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(B,{children:"Loading API data..."})]}):n?e.jsx(V,{variant:"destructive",children:e.jsxs(B,{children:["Error loading API data: ",n.message]})}):r?e.jsx(V,{variant:"destructive",children:e.jsx(B,{children:"Application not found."})}):null;function ns(){const{applicationId:s,apiId:n}=ve(),[r,h]=we(),m=r.get("tab"),[o,j]=g.useState(m||"details"),{applications:t,isLoading:d}=ke(),c=t==null?void 0:t.find(P=>P.id===s),{organizations:i,isLoading:N}=De(),x=i==null?void 0:i.find(P=>c!=null&&c.organization_id?P.id===c.organization_id:!1),{form:p,isEditMode:v,isSubmitting:y,isApiLoading:b,apiError:a,sourceType:f,setSourceType:C,codeLanguage:F,setCodeLanguage:l,handleFetchContent:I,shouldFetchContent:Y,setShouldFetchContent:xe,initialValues:Z,onSubmit:ue}=Fe({applicationId:s,apiId:n}),je=P=>{j(P),h({tab:P})},pe=d||N||b;return e.jsx(We,{children:e.jsxs(R,{children:[e.jsxs(E,{children:[e.jsx(K,{children:v?"Edit API":"Create API"}),e.jsx(be,{children:v?"Edit the API details below.":"Create a new API for your application."})]}),e.jsxs(_,{children:[e.jsx(ts,{isLoading:pe,error:a,applicationMissing:!c}),c&&e.jsx(ye,{...p,children:e.jsx("form",{onSubmit:p.handleSubmit(ue),className:"space-y-6",children:e.jsx(as,{form:p,isSubmitting:y,isNew:!v,applicationId:s||"",sourceType:f,setSourceType:C,codeLanguage:F,setCodeLanguage:l,onFetchContent:I,shouldFetchContent:Y,setShouldFetchContent:xe,applicationSlug:c==null?void 0:c.slug,organizationSlug:x==null?void 0:x.slug,apiVersion:p.watch("version"),apiSlug:Z==null?void 0:Z.slug,activeTab:o,setActiveTab:je,apiId:n})})})]})]})})}const Gs=()=>e.jsx(ns,{});export{Gs as default};
//# sourceMappingURL=ApiFormPage-D1d26-4K.js.map

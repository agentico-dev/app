{"version":3,"file":"ProfilePage-Am_l0c16.js","sources":["../../src/pages/ProfilePage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Outlet, useLocation } from 'react-router';\nimport { useAuth } from '@/hooks/useAuth';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { useForm } from 'react-hook-form';\nimport { toast } from 'sonner';\nimport { AlertCircle, Trash2 } from 'lucide-react';\nimport { Alert, AlertDescription } from '@/components/ui/alert';\nimport { apiTable } from '@/utils/supabaseHelpers';\nimport { supabase } from '@/integrations/supabase/client';\nimport PlanSelector from '@/components/PlanSelector';\nimport { Separator } from '@/components/ui/separator';\nimport { usePlans } from '@/hooks/usePlans';\n\nconst ProfilePage = () => {\n  const location = useLocation();\n  const { user, profile, loading } = useAuth();\n  const [isUpdating, setIsUpdating] = useState(false);\n\n  const { plans, currentPlan, updatePlan, cancelSubscription, isLoading: plansLoading } = usePlans();\n\n  const { register, handleSubmit, formState: { errors } } = useForm({\n    defaultValues: {\n      full_name: profile?.full_name || user?.user_metadata?.full_name || '',\n      job_title: profile?.job_title || '',\n      company: profile?.company || '',\n      bio: profile?.bio || '',\n    }\n  });\n\n  const onSubmit = async (data) => {\n    if (!user) return;\n    \n    setIsUpdating(true);\n    try {\n      // Update user metadata in auth\n      const { error: authError } = await supabase.auth.updateUser({\n        data: { full_name: data.full_name }\n      });\n      \n      if (authError) throw authError;\n      \n      // Update profile in profiles table\n      const { error: profileError } = await apiTable('profiles')\n        .upsert({\n          id: user.id,\n          full_name: data.full_name,\n          job_title: data.job_title,\n          company: data.company,\n          bio: data.bio,\n          updated_at: new Date().toISOString()\n        });\n      \n      if (profileError) throw profileError;\n      \n      toast.success('Profile updated successfully');\n    } catch (error) {\n      console.error('Error updating profile:', error);\n      toast.error(`Failed to update profile: ${error.message || 'Unknown error'}`);\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n  \n  // Check if we're on a nested route\n  const isNestedRoute = location.pathname !== '/profile' && location.pathname !== '/settings';\n  \n  if (isNestedRoute) {\n    return <Outlet />;\n  }\n  \n  if (loading) {\n    return <div className=\"flex items-center justify-center p-8\">Loading profile...</div>;\n  }\n\n  if (!user) {\n    return (\n      <Card className=\"max-w-md mx-auto my-8\">\n        <CardHeader>\n          <CardTitle>Profile Not Available</CardTitle>\n          <CardDescription>You need to be logged in to view your profile.</CardDescription>\n        </CardHeader>\n      </Card>\n    );\n  }\n\n  const userInitials = (profile?.full_name || user.user_metadata?.full_name || user.email || '')\n    .split(' ')\n    .map(part => part[0])\n    .join('')\n    .toUpperCase();\n    const handlePlanChange = async (planId: string) => {\n      try {\n        await updatePlan.mutateAsync(planId);\n        toast.success(\"Plan updated\", {\n          description: \"Your subscription plan has been updated successfully.\",\n        });\n      } catch (error: any) {\n        toast.error(\"Error updating plan\", {\n          description: error.message || \"Failed to update your plan.\",\n        });\n      }\n    };\n  \n    const handleCancelSubscription = () => {\n      cancelSubscription.mutate();\n    };\n\n  return (\n    <div className=\"container mx-auto py-8\">\n      <Tabs defaultValue=\"profile\" className=\"w-full max-w-4xl mx-auto\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"profile\">Profile</TabsTrigger>\n          <TabsTrigger value=\"settings\">Account Settings</TabsTrigger>\n          <TabsTrigger value=\"plan\">Subscription</TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"profile\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center gap-4\">\n                <Avatar className=\"h-16 w-16\">\n                  <AvatarImage src={user.user_metadata?.avatar_url} />\n                  <AvatarFallback>{userInitials}</AvatarFallback>\n                </Avatar>\n                <div>\n                  <CardTitle>{profile?.full_name || user.user_metadata?.full_name || user.email}</CardTitle>\n                  <CardDescription>{user.email}</CardDescription>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"full_name\">Full Name</Label>\n                      <Input \n                        id=\"full_name\" \n                        {...register('full_name')} \n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"job_title\">Job Title</Label>\n                      <Input \n                        id=\"job_title\" \n                        {...register('job_title')} \n                      />\n                    </div>\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"company\">Company</Label>\n                    <Input \n                      id=\"company\" \n                      {...register('company')} \n                    />\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"bio\">Bio</Label>\n                    <Input \n                      id=\"bio\" \n                      {...register('bio')} \n                    />\n                  </div>\n                </div>\n                \n                <Button type=\"submit\" disabled={isUpdating}>\n                  {isUpdating ? 'Saving...' : 'Save Changes'}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n        </TabsContent>\n        \n        <TabsContent value=\"settings\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Account Settings</CardTitle>\n              <CardDescription>Manage your account settings and preferences.</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-6\">\n                <div>\n                  <h3 className=\"text-lg font-medium\">Email</h3>\n                  <p className=\"text-sm text-muted-foreground\">{user.email}</p>\n                </div>\n                \n                <div>\n                  <h3 className=\"text-lg font-medium\">Change Password</h3>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    Update your password to improve account security.\n                  </p>\n                  <Button variant=\"outline\">Change Password</Button>\n                </div>\n                \n                <div className=\"border-t pt-6\">\n                  <h3 className=\"text-lg font-medium text-destructive\">Danger Zone</h3>\n                  <p className=\"text-sm text-muted-foreground mb-4\">\n                    Delete your account and all associated data.\n                  </p>\n                  <Button variant=\"destructive\">Delete Account</Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>        \n          \n        <TabsContent value=\"plan\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Subscription Plan</CardTitle>\n                <CardDescription>\n                  Manage your subscription and billing.\n                </CardDescription>\n              </CardHeader>\n              \n              <CardContent className=\"space-y-6\">\n                <Alert>\n                  <AlertCircle className=\"h-4 w-4\" />\n                  <AlertDescription>\n                    During the beta period, all plans are free. Choose the plan that best suits your needs.\n                  </AlertDescription>\n                </Alert>\n                \n                <div className=\"space-y-4\">\n                  <h3 className=\"text-lg font-medium\">Current Plan: <span className=\"text-primary capitalize\">{currentPlan?.name || 'Free'}</span></h3>\n                  <p className=\"text-muted-foreground\">Select a plan to change your subscription:</p>\n                  \n                  <PlanSelector\n                    plans={plans}\n                    selectedPlan={profile?.plan_id || 'free'}\n                    onSelectPlan={handlePlanChange}\n                  />\n                </div>\n                \n                <Separator />\n                \n                <div className=\"space-y-2\">\n                  <h3 className=\"text-lg font-medium text-destructive\">Cancel Subscription</h3>\n                  <p className=\"text-muted-foreground\">\n                    Cancel your subscription and downgrade to the Free plan.\n                  </p>\n                  <Button\n                    variant=\"outline\"\n                    className=\"mt-2\"\n                    onClick={handleCancelSubscription}\n                    disabled={profile?.plan_id === 'free' || !profile?.plan_id}\n                  >\n                    <Trash2 className=\"mr-2 h-4 w-4\" />\n                    Cancel Subscription\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n      </Tabs>\n      \n      <Outlet />\n    </div>\n  );\n};\n\nexport default ProfilePage;\n"],"names":["ProfilePage","location","useLocation","user","profile","loading","useAuth","isUpdating","setIsUpdating","useState","plans","currentPlan","updatePlan","cancelSubscription","usePlans","register","handleSubmit","errors","useForm","_a","onSubmit","data","authError","supabase","profileError","apiTable","toast","error","Outlet","jsx","Card","CardHeader","CardTitle","CardDescription","userInitials","_b","part","handlePlanChange","planId","handleCancelSubscription","jsxs","Tabs","TabsList","TabsTrigger","TabsContent","Avatar","AvatarImage","_c","AvatarFallback","_d","CardContent","Label","Input","Button","Alert","AlertCircle","AlertDescription","PlanSelector","Separator","Trash2"],"mappings":"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"}
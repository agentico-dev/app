var ve=Object.defineProperty;var we=(s,n,r)=>n in s?ve(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r;var ee=(s,n,r)=>we(s,typeof n!="symbol"?n+"":n,r);import{R as ye,j as e,r as f,l as Q,u as be,p as Ce}from"./react-vendor-BIgZFnT2.js";import{C as M,a as E,d as $,e as G,b as X,c as Ae}from"./card-Nfi7rt9A.js";import{a as A,b as k,c as S,d as T,e as se,f as D,F as ke}from"./form-DN-EFpiu.js";import{c as F,a as O,T as Se,h as Te,i as De,j as Fe}from"./index-CXZKCkms.js";import{S as te,a as Pe,b as Re}from"./useApiForm-BWrzKYHh.js";import{u as Ie}from"./useOrganizations-BJKbR8Ka.js";import{I as L}from"./input-BTxwilxg.js";import{B as w}from"./button-kXSeDcDx.js";import{R as Le,a as z}from"./radio-group-CGmvQLw7.js";import{L as _}from"./label-BGrSP2vm.js";import{T as Me}from"./textarea-aX6xt-XV.js";import{T as Ee}from"./TagBadge-Bs7BNM6v.js";import{C as Y}from"./circle-plus-CWxrycoa.js";import{C as ne}from"./check-DggwCmCB.js";import{U as re,W as $e}from"./ui-components-CeV64dF6.js";import{A as H,a as q}from"./alert-C8MQOhFk.js";import{C as ze}from"./circle-alert-CNPlcFBt.js";import{A as _e}from"./arrow-left-By3eKyga.js";import{u as Ve}from"./useApplicationServices-D6XbOaY9.js";import{S as u}from"./skeleton-D3W9Prr0.js";import{B}from"./badge-DR5nUtuV.js";import{A as le,a as ie,b as ce,c as oe,d as de,e as me,f as he,g as xe}from"./alert-dialog-Ch-Xms6t.js";import{T as ue}from"./trash-2-DiwjfbLh.js";import{u as He}from"./useApplicationMessages-NvvFWmqb.js";import{C as qe}from"./circle-check-big-BIeRBskB.js";import{T as Be,a as Ge,b as J,c as K}from"./tabs-CN0fFsYQ.js";import"./data-management-CvhHSD84.js";import"./utils-CP2dCvBX.js";import"./form-components-KkGWRa5t.js";import"./circle-BMOyQHMR.js";import"./tag-DW6q7fgi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=F("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=F("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=F("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=F("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=F("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=F("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=F("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);class Qe extends ye.Component{constructor(){super(...arguments);ee(this,"state",{hasError:!1})}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(r){console.error("ErrorBoundary caught an error:",r)}render(){return this.state.hasError?e.jsx("div",{children:"Something went wrong. Please try again later."}):this.props.children}}function Xe({selectedTags:s=[],onChange:n}){const[r,h]=f.useState(""),m=()=>{if(r.trim()&&!s.includes(r.trim())){const t=[...s,r.trim()];n(t),h("")}},o=t=>{t.key==="Enter"&&(t.preventDefault(),m())},j=t=>{n(s.filter(d=>d!==t))};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{value:r,onChange:t=>h(t.target.value),onKeyDown:o,placeholder:"Add a tag",className:"flex-1"}),e.jsx(w,{type:"button",variant:"outline",size:"icon",onClick:m,disabled:!r.trim(),children:e.jsx(Y,{className:"h-4 w-4"})})]}),s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.map((t,d)=>e.jsx(Ee,{name:t,onRemove:()=>j(t)},d))})]})}function Ye({value:s,onChange:n,language:r="json",className:h,readOnly:m=!1}){const[o,j]=f.useState(!1),[t,d]=f.useState(s||"");f.useEffect(()=>{s!==void 0&&s!==t&&d(s)},[s]);const c=()=>{navigator.clipboard.writeText(t),j(!0),setTimeout(()=>j(!1),2e3)},i=x=>{const p=x.target.value;d(p),n(p)},N=()=>{if(!m)try{if(r==="json"){const x=JSON.stringify(JSON.parse(t||"{}"),null,2);d(x),n(x)}}catch(x){console.error("Failed to format code:",x)}};return e.jsxs("div",{className:O("relative border rounded-md",h,m?"opacity-75":""),children:[e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[r==="json"?e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium",children:r.toUpperCase()}),m&&e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(Read Only)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!m&&e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:N,title:"Format code",type:"button",disabled:m,children:"Format"}),e.jsx(w,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:c,title:o?"Copied!":"Copy to clipboard",type:"button",children:o?e.jsx(ne,{className:"h-3 w-3"}):e.jsx(Oe,{className:"h-3 w-3"})})]})]}),e.jsx("textarea",{value:t,onChange:i,className:O("font-mono text-sm p-3 w-full min-h-[200px] outline-none focus:ring-0 resize-y",m&&"bg-muted cursor-not-allowed"),spellCheck:"false","data-gramm":"false",readOnly:m})]})}const je=f.forwardRef(({className:s,...n},r)=>e.jsx(re,{ref:r,className:O("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:e.jsx($e,{className:O("flex items-center justify-center text-current"),children:e.jsx(ne,{className:"h-4 w-4"})})}));je.displayName=re.displayName;const Ue=({form:s,isUriValid:n,onFetchContent:r,shouldFetchContent:h,setShouldFetchContent:m,isContentMode:o,codeLanguage:j,sourceUri:t})=>{const[d,c]=f.useState(!1);return f.useEffect(()=>{(t==null?void 0:t.length)>0&&(t!=null&&t.startsWith("urn:"))?c(!0):c(!1)},[s.watch("source_uri")]),f.useEffect(()=>{t!=null&&t.startsWith("urn:")&&!o&&s.setValue("source_uri","")},[o]),e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{control:s.control,name:"source_uri",render:({field:i})=>e.jsxs(k,{children:[e.jsx(S,{children:"Source URI"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(Se,{children:e.jsxs(Te,{open:!n,children:[e.jsx(De,{asChild:!0,children:e.jsx(T,{children:e.jsx(L,{placeholder:"https://example.com/api-spec.json",...i,readOnly:o,className:`w-full ${d?"bg-muted":""} ${n?"":"border-red-500 focus-visible:ring-red-500"}`})})}),e.jsx(Fe,{className:"bg-red-500 text-white",children:e.jsx("p",{children:"Please enter a valid URL (https://example.com/spec.json, urn:agentico:apis:[ORG]:[APP]:[SLUG]:[VERSION])"})})]})}),r&&e.jsxs(w,{type:"button",variant:"outline",onClick:r,title:"Fetch and load content from URI",disabled:o||!n,children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"})," Fetch"]})]}),e.jsx(se,{children:"Link to the API specification file (OpenAPI, Swagger, etc.)"}),e.jsx(D,{})]})}),m&&e.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[e.jsx(je,{id:"fetch-on-save",checked:h,onCheckedChange:i=>m(i),disabled:o||!n}),e.jsx("label",{htmlFor:"fetch-on-save",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:"Fetch content from URI when saving"})]}),e.jsx(A,{control:s.control,name:"source_content",render:({field:i})=>e.jsxs(k,{children:[e.jsx(S,{children:"Source Content"}),!i.value&&!o&&n&&e.jsxs(H,{className:"mb-3 bg-yellow-50 border-yellow-200",children:[e.jsx(ze,{className:"h-4 w-4 text-yellow-600"}),e.jsx(q,{className:"text-yellow-700",children:'The content is empty. Click the "Fetch" button above to load content from the URI, or check "Fetch content from URI when saving".'})]}),e.jsx(T,{children:e.jsx(Ye,{value:i.value||"",onChange:i.onChange,language:j,className:"min-h-[300px]",readOnly:!o&&(t==null?void 0:t.length)>0&&!d})}),e.jsx(se,{children:o||!((t==null?void 0:t.length)>0)||t!=null&&t.startsWith("urn:")?"Paste or write your API specification (OpenAPI, Swagger, gRPC, etc.)":"Fetched API specification (read-only)"}),e.jsx(D,{})]})})]})};function es(s,n,r,h,m){const o=s.getValues("name")||"",j=n||o.toLowerCase().replace(/[^a-z0-9]/g,"-"),t=`urn:agentico:apis:${r}:${h||"app"}:${j}:${m}`;console.log("Generated URN:",t),s.setValue("source_uri",t)}const ss=({form:s,sourceType:n,setSourceType:r,codeLanguage:h,setCodeLanguage:m,onFetchContent:o,shouldFetchContent:j,setShouldFetchContent:t,applicationSlug:d,organizationSlug:c="global",apiVersion:i="1.0.0",apiSlug:N})=>{const[x,p]=f.useState(!0),[v,b]=f.useState(!1);function y(l){try{return new URL(l),!0}catch{return/^urn:agentico:apis:[a-zA-Z0-9\-]+:[a-zA-Z0-9\-]+:[a-zA-Z0-9\-]+:[a-zA-Z0-9\-]+$/.test(l)}}const a=s.watch("source_uri"),g=s.watch("source_content"),C=s.watch("name"),P=s.watch("version");return f.useEffect(()=>{p(y(a));const l=(g==null?void 0:g.length)>0;b(l)},[a,g]),f.useEffect(()=>{console.log("Updated Source mode:",{isContentMode:v,sourceUri:a,sourceContent:g,sourceType:n})},[v,a,g,n]),f.useEffect(()=>{v&&g.length>0&&(!a||!a.startsWith("urn:"))&&(es(s,N,c,d,P||i),console.log("Generated URN based on content change"))},[n,g,C,P,a,N,c,d,i,s]),e.jsxs("div",{className:"space-y-4 border p-4 rounded-md",children:[e.jsx("h3",{className:"text-lg font-medium",children:"API Source"}),e.jsx(Ue,{form:s,isUriValid:x,onFetchContent:o,shouldFetchContent:j,setShouldFetchContent:t,isContentMode:v,codeLanguage:h,sourceUri:a})]})};function ae({form:s,isSubmitting:n,isNew:r,sourceType:h,setSourceType:m,codeLanguage:o,setCodeLanguage:j,onFetchContent:t,shouldFetchContent:d,setShouldFetchContent:c,applicationSlug:i,organizationSlug:N,apiVersion:x,apiSlug:p,onCancel:v}){const y=s.watch("version")||x||"1.0.0";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(A,{control:s.control,name:"name",render:({field:a})=>e.jsxs(k,{children:[e.jsx(S,{children:"API Name *"}),e.jsx(T,{children:e.jsx(L,{placeholder:"Enter API name",...a})}),e.jsx(D,{})]})}),e.jsx(A,{control:s.control,name:"version",render:({field:a})=>e.jsxs(k,{children:[e.jsx(S,{children:"API Version"}),e.jsx(T,{children:e.jsx(L,{placeholder:"e.g. 1.0, v2, etc.",...a})}),e.jsx(D,{})]})})]}),e.jsx(A,{control:s.control,name:"description",render:({field:a})=>e.jsxs(k,{children:[e.jsx(S,{children:"Description"}),e.jsx(T,{children:e.jsx(Me,{placeholder:"Describe the purpose and functionality of this API",className:"min-h-[100px]",...a})}),e.jsx(D,{})]})}),e.jsx(A,{control:s.control,name:"status",render:({field:a})=>e.jsxs(k,{className:"space-y-3",children:[e.jsx(S,{children:"Status"}),e.jsx(T,{children:e.jsxs(Le,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{value:"active",id:"active"}),e.jsx(_,{htmlFor:"active",children:"Active"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{value:"inactive",id:"inactive"}),e.jsx(_,{htmlFor:"inactive",children:"Inactive"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{value:"deprecated",id:"deprecated"}),e.jsx(_,{htmlFor:"deprecated",children:"Deprecated"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{value:"archived",id:"archived"}),e.jsx(_,{htmlFor:"archived",children:"Archived"})]})]})}),e.jsx(D,{})]})}),e.jsx(A,{control:s.control,name:"tags",render:({field:a})=>e.jsxs(k,{children:[e.jsx(S,{children:"Tags"}),e.jsx(T,{children:e.jsx(Xe,{selectedTags:a.value||[],onChange:a.onChange})}),e.jsx(D,{})]})}),e.jsx("div",{className:"space-y-4",children:e.jsx(ss,{form:s,sourceType:h,setSourceType:m,codeLanguage:o,setCodeLanguage:j,onFetchContent:t,shouldFetchContent:d,setShouldFetchContent:c,applicationSlug:i,organizationSlug:N,apiVersion:y,apiSlug:p})}),e.jsxs("div",{className:"flex justify-between pt-6",children:[e.jsxs(w,{type:"button",variant:"outline",onClick:v,children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Cancel"]}),e.jsxs(w,{type:"submit",disabled:n,children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),n?"Saving...":r?"Create API":"Update API"]})]})]})}function as({apiId:s,applicationId:n}){const r=Q(),{services:h,isLoading:m,error:o,deleteService:j}=Ve(n,s),[t,d]=f.useState(""),[c,i]=f.useState(null),[N,x]=f.useState(!1),p=h==null?void 0:h.filter(a=>t===""||a.name.toLowerCase().includes(t.toLowerCase())||a.description&&a.description.toLowerCase().includes(t.toLowerCase())),v=async()=>{if(c){x(!0);try{await j.mutateAsync(c.id)}finally{x(!1),i(null)}}},b=a=>{const g=new Date(a);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(g)},y=a=>{switch(a){case"active":return"bg-green-500";case"inactive":return"bg-gray-500";case"maintenance":return"bg-amber-500";default:return"bg-blue-500"}};return m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(u,{className:"h-10 w-64"}),e.jsx(u,{className:"h-10 w-40"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((a,g)=>e.jsxs(M,{children:[e.jsxs(E,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(u,{className:"h-6 w-1/2"}),e.jsx(u,{className:"h-4 w-16 rounded-full"})]}),e.jsx(u,{className:"h-5 w-24 mt-2"})]}),e.jsxs($,{children:[e.jsx(u,{className:"h-4 w-full mb-2"}),e.jsx(u,{className:"h-4 w-2/3 mb-4"}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-3",children:[e.jsx(u,{className:"h-5 w-16 rounded-full"}),e.jsx(u,{className:"h-5 w-20 rounded-full"})]}),e.jsx(u,{className:"h-4 w-36 mt-4"})]}),e.jsxs(G,{className:"flex justify-between",children:[e.jsx(u,{className:"h-9 w-20"}),e.jsx(u,{className:"h-9 w-20"})]})]},g))})]}):o?e.jsxs("div",{className:"text-center py-8 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Error loading services"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"There was a problem loading the service list. Please try again."}),e.jsx(w,{onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{placeholder:"Search services...",value:t,onChange:a=>d(a.target.value),className:"max-w-sm"}),e.jsxs(w,{onClick:()=>r(`/applications/${n}/services/new?api_id=${s}`),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"})," New Service"]})]}),p&&p.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.map(a=>e.jsxs(M,{className:"overflow-hidden",children:[e.jsxs(E,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(X,{className:"text-lg font-medium",children:a.name}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:`rounded-full h-2 w-2 ${y(a.status||"active")}`}),e.jsx("span",{className:"text-xs capitalize",children:a.status||"active"})]})]}),a.service_type&&e.jsx(B,{variant:"outline",className:"mt-1",children:a.service_type})]}),e.jsxs($,{className:"pb-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:a.description||"No description provided"}),a.method&&a.path&&e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx(B,{variant:"outline",className:"uppercase font-mono",children:a.method}),e.jsx("span",{className:"text-xs font-mono truncate",children:a.path})]}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-1",children:a.tags&&a.tags.map((g,C)=>e.jsx(B,{variant:"secondary",className:"text-xs",children:g},C))}),e.jsxs("p",{className:"mt-4 text-xs text-muted-foreground",children:["Created: ",b(a.created_at)]})]}),e.jsxs(G,{className:"flex justify-between pt-0",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>r(`/applications/${n}/services/${a.id}?api_id=${s}`),children:[e.jsx(te,{className:"h-4 w-4 mr-1"})," Edit"]}),e.jsxs(w,{variant:"destructive",size:"sm",onClick:()=>i(a),children:[e.jsx(ue,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},a.id))}):e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"No services found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:t?"No services match your search criteria.":"This API doesn't have any services yet."}),e.jsx(w,{onClick:()=>r(`/applications/${n}/services/new?api_id=${s}`),children:"Create your first service"})]}),e.jsx(le,{open:!!c,onOpenChange:a=>!a&&i(null),children:e.jsxs(ie,{children:[e.jsxs(ce,{children:[e.jsx(oe,{children:"Are you sure you want to delete this service?"}),e.jsxs(de,{children:['This action cannot be undone. This will permanently delete the service "',c==null?void 0:c.name,'" and all its associated data.']})]}),e.jsxs(me,{children:[e.jsx(he,{disabled:N,children:"Cancel"}),e.jsx(xe,{onClick:v,disabled:N,className:"relative",children:N?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}function ts({apiId:s,applicationId:n}){const r=Q(),{messages:h,isLoading:m,error:o,deleteMessage:j,markAsRead:t}=He(n,s),[d,c]=f.useState(""),[i,N]=f.useState(null),[x,p]=f.useState(!1),[v,b]=f.useState(null),y=h==null?void 0:h.filter(l=>d===""||l.title.toLowerCase().includes(d.toLowerCase())||l.content.toLowerCase().includes(d.toLowerCase())),a=async()=>{if(i){p(!0);try{await j.mutateAsync(i.id)}finally{p(!1),N(null)}}},g=async l=>{b(l);try{await t.mutateAsync(l)}finally{b(null)}},C=l=>{const R=new Date(l);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(R)},P=l=>{switch(l){case"notification":return e.jsx(V,{className:"h-4 w-4 text-blue-500"});case"alert":return e.jsx(V,{className:"h-4 w-4 text-red-500"});case"info":return e.jsx(V,{className:"h-4 w-4 text-green-500"});default:return e.jsx(V,{className:"h-4 w-4"})}};return m?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(u,{className:"h-10 w-64"}),e.jsx(u,{className:"h-10 w-40"})]}),e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((l,R)=>e.jsxs(M,{className:"overflow-hidden",children:[e.jsx(E,{children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx(u,{className:"h-6 w-1/3"}),e.jsx(u,{className:"h-6 w-20"})]})}),e.jsxs($,{children:[e.jsx(u,{className:"h-4 w-full mb-2"}),e.jsx(u,{className:"h-4 w-2/3 mb-2"}),e.jsx(u,{className:"h-4 w-1/2 mb-4"}),e.jsx(u,{className:"h-4 w-32 mt-4"})]}),e.jsxs(G,{className:"flex justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{className:"h-9 w-20"}),e.jsx(u,{className:"h-9 w-28"})]}),e.jsx(u,{className:"h-9 w-20"})]})]},R))})]}):o?e.jsxs("div",{className:"text-center py-8 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Error loading messages"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"There was a problem loading the message list. Please try again."}),e.jsx(w,{onClick:()=>window.location.reload(),children:"Retry"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(L,{placeholder:"Search messages...",value:d,onChange:l=>c(l.target.value),className:"max-w-sm"}),e.jsxs(w,{onClick:()=>r(`/applications/${n}/messages/new?api_id=${s}`),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"})," New Message"]})]}),y&&y.length>0?e.jsx("div",{className:"space-y-4",children:y.map(l=>e.jsxs(M,{className:`overflow-hidden ${l.status==="unread"?"border-blue-300":""}`,children:[e.jsx(E,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[P(l.message_type),e.jsx(X,{className:"text-lg font-medium",children:l.title})]}),e.jsx(B,{variant:l.status==="unread"?"default":"outline",children:l.status})]})}),e.jsxs($,{className:"pb-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:l.content}),e.jsx("p",{className:"mt-4 text-xs text-muted-foreground",children:C(l.created_at)})]}),e.jsxs(G,{className:"flex justify-between pt-0",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>r(`/applications/${n}/messages/${l.id}?api_id=${s}`),children:[e.jsx(te,{className:"h-4 w-4 mr-1"})," Edit"]}),l.status==="unread"&&e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>g(l.id),disabled:v===l.id,children:[v===l.id?e.jsx(Z,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(qe,{className:"h-4 w-4 mr-1"}),"Mark as Read"]})]}),e.jsxs(w,{variant:"destructive",size:"sm",onClick:()=>N(l),children:[e.jsx(ue,{className:"h-4 w-4 mr-1"})," Delete"]})]})]},l.id))}):e.jsxs("div",{className:"text-center py-12 border rounded-lg bg-muted/10",children:[e.jsx("h3",{className:"text-lg font-medium",children:"No messages found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:d?"No messages match your search criteria.":"This API doesn't have any messages yet."}),e.jsx(w,{onClick:()=>r(`/applications/${n}/messages/new?api_id=${s}`),children:"Create your first message"})]}),e.jsx(le,{open:!!i,onOpenChange:l=>!l&&N(null),children:e.jsxs(ie,{children:[e.jsxs(ce,{children:[e.jsx(oe,{children:"Are you sure you want to delete this message?"}),e.jsxs(de,{children:['This action cannot be undone. This will permanently delete the message "',i==null?void 0:i.title,'".']})]}),e.jsxs(me,{children:[e.jsx(he,{disabled:x,children:"Cancel"}),e.jsx(xe,{onClick:a,disabled:x,className:"relative",children:x?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete"})]})]})})]})}function ns({form:s,isSubmitting:n,isNew:r,applicationId:h,sourceType:m,setSourceType:o,codeLanguage:j,setCodeLanguage:t,onFetchContent:d,shouldFetchContent:c,setShouldFetchContent:i,applicationSlug:N,organizationSlug:x,apiVersion:p,apiSlug:v,activeTab:b="details",setActiveTab:y,apiId:a}){const g=Q();s.watch("source_content");const C=()=>{g(`/applications/${h}`)};return r?e.jsx("div",{children:e.jsx(ae,{form:s,isSubmitting:n,isNew:r,sourceType:m,setSourceType:o,codeLanguage:j,setCodeLanguage:t,onFetchContent:d,shouldFetchContent:c,setShouldFetchContent:i,applicationSlug:N,organizationSlug:x,apiVersion:p,apiSlug:v,onCancel:C})}):e.jsx("div",{className:"space-y-6",children:e.jsxs(Be,{defaultValue:b,onValueChange:y||(()=>{}),className:"w-full",children:[e.jsxs(Ge,{className:"grid w-full grid-cols-3",children:[e.jsx(J,{value:"details",children:"API Details"}),e.jsx(J,{value:"services",children:"Services"}),e.jsx(J,{value:"messages",children:"Messages"})]}),e.jsx(K,{value:"details",className:"pt-4",children:e.jsx(ae,{form:s,isSubmitting:n,isNew:r,sourceType:m,setSourceType:o,codeLanguage:j,setCodeLanguage:t,onFetchContent:d,shouldFetchContent:c,setShouldFetchContent:i,applicationSlug:N,organizationSlug:x,apiVersion:p,apiSlug:v,onCancel:C})}),e.jsx(K,{value:"services",className:"pt-4",children:e.jsx(as,{apiId:a,applicationId:h})}),e.jsx(K,{value:"messages",className:"pt-4",children:e.jsx(ts,{apiId:a,applicationId:h})})]})})}const rs=({isLoading:s,error:n,applicationMissing:r})=>s?e.jsxs(H,{children:[e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(q,{children:"Loading API data..."})]}):n?e.jsx(H,{variant:"destructive",children:e.jsxs(q,{children:["Error loading API data: ",n.message]})}):r?e.jsx(H,{variant:"destructive",children:e.jsx(q,{children:"Application not found."})}):null;function ls(){const{applicationId:s,apiId:n}=be(),[r,h]=Ce(),m=r.get("tab"),[o,j]=f.useState(m||"details"),{applications:t,isLoading:d}=Pe(),c=t==null?void 0:t.find(I=>I.id===s),{organizations:i,isLoading:N}=Ie(),x=i==null?void 0:i.find(I=>c!=null&&c.organization_id?I.id===c.organization_id:!1),{form:p,isEditMode:v,isSubmitting:b,isApiLoading:y,apiError:a,sourceType:g,setSourceType:C,codeLanguage:P,setCodeLanguage:l,handleFetchContent:R,shouldFetchContent:U,setShouldFetchContent:pe,initialValues:W,onSubmit:fe}=Re({applicationId:s,apiId:n}),ge=I=>{j(I),h({tab:I})},Ne=d||N||y;return e.jsx(Qe,{children:e.jsxs(M,{children:[e.jsxs(E,{children:[e.jsx(X,{children:v?"Edit API":"Create API"}),e.jsx(Ae,{children:v?"Edit the API details below.":"Create a new API for your application."})]}),e.jsxs($,{children:[e.jsx(rs,{isLoading:Ne,error:a,applicationMissing:!c}),c&&e.jsx(ke,{...p,children:e.jsx("form",{onSubmit:p.handleSubmit(fe),className:"space-y-6",children:e.jsx(ns,{form:p,isSubmitting:b,isNew:!v,applicationId:s||"",sourceType:g,setSourceType:C,codeLanguage:P,setCodeLanguage:l,onFetchContent:R,shouldFetchContent:U,setShouldFetchContent:pe,applicationSlug:c==null?void 0:c.slug,organizationSlug:x==null?void 0:x.slug,apiVersion:p.watch("version"),apiSlug:W==null?void 0:W.slug,activeTab:o,setActiveTab:ge,apiId:n})})})]})]})})}const _s=()=>e.jsx(ls,{});export{_s as default};
